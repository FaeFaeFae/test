HXWebWorkflowEditor={};HXWebWorkflowEditor.Register=function(editorDIVContainer,objHXXmlDoc,blnIsEditMode,options,editorToolboxDivContainer){HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow=objHXXmlDoc;HXWebWorkflowEditor._Internal._EditorDivContainerHtmlElement=editorDIVContainer;HXWebWorkflowEditor._Internal._CurrentChosenWorkflowNodeCode="";HXWebWorkflowEditor._Internal._CurrentChosenWorkflowNodeType="";HXWebWorkflowEditor._Internal._IsInEditMode=blnIsEditMode;HXWebWorkflowEditor._Internal._EditorToolBoxAreaHtmlElement=editorToolboxDivContainer;var _options={allow_point_to_running_node:false,db_language_type:0};if(options!=null){if(options.allow_point_to_running_node!=null){_options.allow_point_to_running_node=options.allow_point_to_running_node}if(options.db_language_type!=null){_options.db_language_type=options.db_language_type}}HXWebWorkflowEditor._Internal._options=_options;jQuery(editorDIVContainer).click(HXWebWorkflowEditor._WorkflowEditorCanvas_OnClicked);jQuery(editorDIVContainer).mouseover(HXWebWorkflowEditor._WorkflowEditorCanvas_OnMouseOver);if(blnIsEditMode){HXWebWorkflowEditor._InitEditorToolboxArea(editorDIVContainer,editorToolboxDivContainer)}};HXWebWorkflowEditor.DrawWorkflow=function(){var objHXXmlDoc=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow;var objHXXmlNodeList=objHXXmlDoc.SelectNodes("//HXWORKFLOW_NODE");for(var i=0;i<objHXXmlNodeList.length;i++){HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(objHXXmlNodeList[i])}};HXWebWorkflowEditor._InitEditorToolboxArea=function(editorCanvasDIVContainer,editorToolboxDivContainer){editorToolboxDivContainer.style.display="";editorCanvasDIVContainer.style.left="80px";jQuery("img[hx_workflow_node_type]",editorToolboxDivContainer).draggable({stop:HXWebWorkflowEditor._DragDropProcess._OnToolboxIconDragStopped});jQuery("img[hx_workflow_node_type]",editorToolboxDivContainer).draggable()};HXWebWorkflowEditor._WorkflowEditorCanvas_OnClicked=function(e){var objClickedElement=e.target;var strWorkflowHtmlElementType=jQuery(objClickedElement).attr("hx_workflow_html_element_type");var strWorkflowNodeType=jQuery(objClickedElement).attr("hx_workflow_node_type");var strWorkflowNodeCode=jQuery(objClickedElement).attr("hx_workflow_node_code");if(strWorkflowNodeType==null||strWorkflowNodeType==""){return}strWorkflowNodeType=strWorkflowNodeType.toUpperCase();if(strWorkflowNodeType=="WORKFLOW_START"&&(strWorkflowNodeCode==null||strWorkflowNodeCode=="")){strWorkflowNodeCode="hxworkflowstart"}if(!HXWebWorkflowEditor._Internal._IsInEditMode){if(strWorkflowHtmlElementType==null||strWorkflowHtmlElementType==""){return}if(strWorkflowNodeType=="WORKFLOW_ACTIVITY"&&strWorkflowHtmlElementType!="line_arrow_img"){if(HXWebWorkflowEditor.Extend.OnWorkflowActivityClicked!=null){var objHXXmlNodeForWorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strWorkflowNodeCode);HXWebWorkflowEditor.Extend.OnWorkflowActivityClicked(strWorkflowNodeCode,objHXXmlNodeForWorkflowNode)}}return}if(strWorkflowHtmlElementType=="hxworkflow_node_config_btn"){HXWebWorkflowEditor.CommonElement.ConfigWorkflowNode(strWorkflowNodeType,strWorkflowNodeCode);return}else{if(strWorkflowHtmlElementType=="hxworkflow_node_resize_btn"){HXWebWorkflowEditor.CommonElement.ConfigActivityNodeResizeInfo(strWorkflowNodeCode);return}else{if(strWorkflowHtmlElementType=="hxworkflow_node_remove_btn"){HXWebWorkflowEditor.CommonElement.RemoveWorkflowNode(strWorkflowNodeType,strWorkflowNodeCode);return}}}if(strWorkflowHtmlElementType==null||strWorkflowHtmlElementType==""){HXWebWorkflowEditor._DragDropProcess.RemovePrevisousChosenDraggableNode();return}HXWebWorkflowEditor._DragDropProcess.MarkWorkflowNodeAsDraggable(strWorkflowNodeCode,true)};HXWebWorkflowEditor._WorkflowEditorCanvas_OnMouseOver=function(e){var objEventSrcElement=e.target;var strWorkflowNodeType=jQuery(objEventSrcElement).attr("hx_workflow_node_type");if(strWorkflowNodeType==null||strWorkflowNodeType==""){return}strWorkflowNodeType=strWorkflowNodeType.toUpperCase();if(strWorkflowNodeType!="WORKFLOW_ACTIVITY"){return}if(HXWebWorkflowEditor._Internal._IsInEditMode){return}var strWorkflowNodeCode=jQuery(objEventSrcElement).attr("hx_workflow_node_code");var objHXXmlNodeForWorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strWorkflowNodeCode);if(HXWebWorkflowEditor.Extend.OnWorkflowActivityMouseOver!=null){HXWebWorkflowEditor.Extend.OnWorkflowActivityMouseOver(strWorkflowNodeCode,objHXXmlNodeForWorkflowNode,objEventSrcElement)}else{var blnUseV6PageServerEnginee=(typeof(mstrHXPageServerEnginee)=="string"&&mstrHXPageServerEnginee=="V6");if(blnUseV6PageServerEnginee){var strNodeHintMessage=objHXXmlNodeForWorkflowNode.GetAttributeValue("NODE_PROCESS_HINT_MSG"+(HXWebWorkflowEditor._Internal._options.db_language_type==0?"":"_OT"));if(strNodeHintMessage==null||strNodeHintMessage==""){return}objEventSrcElement.title=strNodeHintMessage;return}var objTempHXXmlNode=objHXXmlNodeForWorkflowNode.SelectSingleNode("WORKFLOW_INSTANCE_DATA");if(objTempHXXmlNode==null){var strActivityType=objHXXmlNodeForWorkflowNode.GetAttributeValue("ACTIVITY_TYPE");if(strActivityType==null||strActivityType==""){return}strActivityType=strActivityType.toUpperCase();var strChoseName=objHXXmlNodeForWorkflowNode.GetAttributeValue(strActivityType+"__CHOSEN_NAME"+(HXWebWorkflowEditor._Internal._options.db_language_type==0?"":"_OT"));if(strChoseName==null||strChoseName==""){return}objEventSrcElement.title=strChoseName;return}var strCurrentApproverName=objTempHXXmlNode.GetAttributeValue("CURRENT_APPROVERS_NAME"+(HXWebWorkflowEditor._Internal._options.db_language_type==0?"":"_OT"));if(strCurrentApproverName==null||strCurrentApproverName==""){return}objEventSrcElement.title=strCurrentApproverName}};HXWebWorkflowEditor._Interface={};HXWebWorkflowEditor._Interface._GetWorkflowNodeConfigPageInfo=null;HXWebWorkflowEditor._Interface._OnWorkflowActivityRemoved=null;HXWebWorkflowEditor.Interface={};HXWebWorkflowEditor.Interface.UpdateWorkflowActivityConfigInfo=null;HXWebWorkflowEditor.Interface.SaveWorkflowContentDirectly=null;HXWebWorkflowEditor.Extend={};HXWebWorkflowEditor.Extend.OnWorkflowActivityClicked=null;HXWebWorkflowEditor.Extend.OnWorkflowActivityMouseOver=null;HXWebWorkflowEditor.Extend.OnWorkflowActivityAfterConfigChanged=null;HXWebWorkflowEditor.CommonElement={};HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine=function(objHXXmlNodeForWorkflowNode){var strTemp;if(typeof(objHXXmlNodeForWorkflowNode)=="string"){strTemp=objHXXmlNodeForWorkflowNode;objHXXmlNodeForWorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strTemp)}if(objHXXmlNodeForWorkflowNode==null){return}var strWorkflowNodeType=objHXXmlNodeForWorkflowNode.GetAttributeValue("TYPE");var strWorkflowNodeCode=objHXXmlNodeForWorkflowNode.GetAttributeValue("CODE");if(strWorkflowNodeType=="WORKFLOW_START"&&(strWorkflowNodeCode==null||strWorkflowNodeCode=="")){strWorkflowNodeCode="hxworkflowstart"}strTemp=objHXXmlNodeForWorkflowNode.GetAttributeValue("NODE_PROCESS_STATUS");var intNodeProcessStatus=(strTemp==null||strTemp==""?0:parseInt(strTemp));var objNodeUIPosition=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetWorkflowNodeUIData(objHXXmlNodeForWorkflowNode);var objNodeMainHtmlElement=HXWebWorkflowEditor.CommonElement._CreateWorkflowNodeMainHtmlElement(strWorkflowNodeType,strWorkflowNodeCode,objHXXmlNodeForWorkflowNode,objNodeUIPosition,intNodeProcessStatus);if(strWorkflowNodeType!="WORKFLOW_START"&&strWorkflowNodeType!="WORKFLOW_CONNECT_POINT_OUT"&&(intNodeProcessStatus==0||(intNodeProcessStatus>0&&HXWebWorkflowEditor._Internal._options.allow_point_to_running_node))){jQuery(objNodeMainHtmlElement).droppable({accept:".hx_workflow_arrow_chosen",tolerance:"touch",over:HXWebWorkflowEditor._DragDropProcess._OnDropOverCallback,out:HXWebWorkflowEditor._DragDropProcess._OnDropOutCallback,drop:HXWebWorkflowEditor._DragDropProcess._OnDropEndCallback})}var objHXXmlNodeList_UILines=objHXXmlNodeForWorkflowNode.SelectNodes(".//UI_DATA/UI_LINE");var lineSetting;var objLineBeginPointAndColorInfo;var ptLineEndPosition;for(var i=0;i<objHXXmlNodeList_UILines.length;i++){HXWebWorkflowEditor.HXWorkflowConnectionLine.DrawLineViaWorkflowDefinition(strWorkflowNodeType,strWorkflowNodeCode,objHXXmlNodeForWorkflowNode,objHXXmlNodeList_UILines[i],objNodeUIPosition)}};HXWebWorkflowEditor.CommonElement.ConfigWorkflowNode=function(strWorkflowNodeType,strWorkflowNodeCode){objHXXmlNodeForWorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strWorkflowNodeCode);var strActivityType="";if(strWorkflowNodeType.toUpperCase()=="WORKFLOW_ACTIVITY"){strActivityType=objHXXmlNodeForWorkflowNode.GetAttributeValue("ACTIVITY_TYPE");if(strActivityType==null){strActivityType=""}}var objConfigPageInfo=HXWebWorkflowEditor._Interface._GetWorkflowNodeConfigPageInfo(strWorkflowNodeType,strActivityType);if(objConfigPageInfo==null){return}var intDialogWidth=objConfigPageInfo.dialog_width;var intDialogHeight=objConfigPageInfo.dialog_height;var blnUseJSONDialogArgument=(!!objConfigPageInfo.use_json_dialog_argument);var strWorkflowDefinitionCode=objConfigPageInfo.workflow_definition_code;var strWorkflowInstanceCode=objConfigPageInfo.workflow_instance_code;if(strWorkflowInstanceCode==null){strWorkflowInstanceCode=""}var blnUseV6PageServerEnginee=(typeof(mstrHXPageServerEnginee)=="string"&&mstrHXPageServerEnginee=="V6");var strConfigPageUrl;if(blnUseV6PageServerEnginee){var intIndex=objConfigPageInfo.config_page_name.indexOf("hxdynamicpage_common_v13:");if(intIndex==0){var strTargetDynamicPageName=objConfigPageInfo.config_page_name.substr(25);strConfigPageUrl=gstrWebRootPath+"hxpublic_v6/hxdynamicpage6.aspx?_hxpage="+strTargetDynamicPageName}else{strConfigPageUrl=gstrWebRootPath+objConfigPageInfo.config_page_name}}else{strConfigPageUrl=gstrWebRootPath+objConfigPageInfo.config_page_name}strConfigPageUrl+=(strConfigPageUrl.indexOf("?")>=0?"&":"?")+"workflow_definition_code="+escape(strWorkflowDefinitionCode)+"&workflow_instance_code="+escape(strWorkflowInstanceCode)+"&workflow_node_code="+escape(strWorkflowNodeCode)+"&activity_type="+escape(strActivityType);var fnDialogCallback=function(objDialogResult){if(objDialogResult==null){return}if(strWorkflowNodeType.toUpperCase()=="WORKFLOW_START"&&!blnUseV6PageServerEnginee){var objNewWorkflowStartNodeAndExtensionNode=HXWebJS.Xml.GetHXXmlDocumentViaXmlString(objDialogResult).GetRootXmlNode();HXWebWorkflowEditor.WorkflowDefinitionUtility._UpdateWorkflowStartNodeAndExtensionConfigInfo(objHXXmlNodeForWorkflowNode,objNewWorkflowStartNodeAndExtensionNode);return}var objNewWorkflowNode=HXWebJS.Xml.GetHXXmlDocumentViaXmlString(objDialogResult).GetRootXmlNode();HXWebWorkflowEditor.WorkflowDefinitionUtility._UpdateWorkflowNodeConfigInfo(strWorkflowNodeType,objHXXmlNodeForWorkflowNode,objNewWorkflowNode);HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(objHXXmlNodeForWorkflowNode);if(strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"){var strConnectPointNo=objHXXmlNodeForWorkflowNode.GetAttributeValue("CONNECT_POINT_NO");var objHXXmlDoc=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow;var objHXXmlNodeList=objHXXmlDoc.SelectNodes("//HXWORKFLOW_NODE[.//UI_DATA/UI_LINE/@LINE_END_TARGET_TYPE='connect_point' and UI_DATA/UI_LINE/@TARGET_CONNECT_POINT_NO="+strConnectPointNo+"]");for(var i=0;i<objHXXmlNodeList.length;i++){HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(objHXXmlNodeList[i].GetAttributeValue("CODE"))}}else{var objHXXmlNodeList=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetWorkflowNodeListWhichPointToSpecifiedNode(strWorkflowNodeCode);for(var i=0;i<objHXXmlNodeList.length;i++){HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(objHXXmlNodeList[i].GetAttributeValue("CODE"))}}strWorkflowNodeCode=objHXXmlNodeForWorkflowNode.GetAttributeValue("CODE");HXWebWorkflowEditor._DragDropProcess.MarkWorkflowNodeAsDraggable(strWorkflowNodeCode,true);return};var strXmlDataParseToDialog=objHXXmlNodeForWorkflowNode.GetXml();if(!blnUseV6PageServerEnginee&&strWorkflowNodeType.toUpperCase()=="WORKFLOW_START"){var objTempHXXmlNode=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectSingleNode("//HXWORKFLOW_EXTENSION__HXAPPROVEWORKFLOW");if(objTempHXXmlNode!=null&&objTempHXXmlNode.GetXml()!=""){strXmlDataParseToDialog="<ALL_DATAS>"+objHXXmlNodeForWorkflowNode.GetXml()+objTempHXXmlNode.GetXml()+"</ALL_DATAS>"}else{strXmlDataParseToDialog="<ALL_DATAS>"+objHXXmlNodeForWorkflowNode.GetXml()+"<HXWORKFLOW_EXTENSION__HXAPPROVEWORKFLOW><NOTIFICATION_USERS><DYNAMIC_EXPRESSION__NOTIFICATION_USERS /></NOTIFICATION_USERS></HXWORKFLOW_EXTENSION__HXAPPROVEWORKFLOW></ALL_DATAS>"}}if(blnUseJSONDialogArgument){dialogArgument={workflow_node_xml:strXmlDataParseToDialog,workflow_definition_code:strWorkflowDefinitionCode,workflow_instance_code:strWorkflowInstanceCode}}else{dialogArgument=strXmlDataParseToDialog}HXWebJS.Navigation.OpenWebDialog(strConfigPageUrl,dialogArgument,intDialogWidth,intDialogHeight,false,fnDialogCallback,true,true)};HXWebWorkflowEditor.CommonElement.ConfigActivityNodeResizeInfo=function(strWorkflowNodeCode){objHXXmlNodeForWorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strWorkflowNodeCode);var strActivityType=objHXXmlNodeForWorkflowNode.GetAttributeValue("ACTIVITY_TYPE");var fnDialogCallback=function(objDialogResult){if(objDialogResult==null){return}var objNewWorkflowNode=HXWebJS.Xml.GetHXXmlDocumentViaXmlString(objDialogResult).GetRootXmlNode();HXWebWorkflowEditor.WorkflowDefinitionUtility._UpdateWorkflowNodeConfigInfo("WORKFLOW_ACTIVITY",objHXXmlNodeForWorkflowNode,objNewWorkflowNode);HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(objHXXmlNodeForWorkflowNode);var objHXXmlNodeList=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetWorkflowNodeListWhichPointToSpecifiedNode(strWorkflowNodeCode);for(var i=0;i<objHXXmlNodeList.length;i++){HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(objHXXmlNodeList[i].GetAttributeValue("CODE"))}strWorkflowNodeCode=objHXXmlNodeForWorkflowNode.GetAttributeValue("CODE");HXWebWorkflowEditor._DragDropProcess.MarkWorkflowNodeAsDraggable(strWorkflowNodeCode,true);return};strConfigPageUrl=gstrWebRootPath+"hxpublic_v6/hxdynamicpage6.aspx?_hxpage=hxsm_v6/hxworkfloweditor_workflow_node_config__common.hxpage.xhtml";var strXmlDataParseToDialog=objHXXmlNodeForWorkflowNode.GetXml();var dialogArgument={workflow_node_xml:strXmlDataParseToDialog,is_for_acitivity_node_resize_only:true};HXWebJS.Navigation.OpenWebDialog(strConfigPageUrl,dialogArgument,800,420,false,fnDialogCallback,true,true)};HXWebWorkflowEditor.CommonElement.RemoveWorkflowNode=function(strWorkflowNodeType,strWorkflowNodeCode){objHXXmlNodeForWorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strWorkflowNodeCode);if(strWorkflowNodeType=="WORKFLOW_END__AGREE"&&HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectNodes("//HXWORKFLOW_NODE[@TYPE='WORKFLOW_END__AGREE']").length==1){var strHintMessage="工作流程至少要需要一个流程成功结束节点，删除操作被取消。";if(HXWebWorkflowEditor._Internal._options.db_language_type==1){strHintMessage="There is at least one node for workflow finished successfully. The remove node operation is cancelled."}alert(strHintMessage);return}var strWorkflowNodeDesc=strWorkflowNodeCode;if(strWorkflowNodeType=="WORKFLOW_RULE"||strWorkflowNodeType=="WORKFLOW_BRANCH"||strWorkflowNodeType=="WORKFLOW_ACTIVITY"){var strWorkflowNodeName=objHXXmlNodeForWorkflowNode.GetAttributeValue("NODE_NAME"+(HXWebWorkflowEditor._Internal._options.db_language_type==1?"_OT":""));if(strWorkflowNodeName!=null&&strWorkflowNodeName!=""){strWorkflowNodeDesc=strWorkflowNodeName+"("+strWorkflowNodeCode+")"}}var strHintMessage="你确定要移除当前工作流程节点{0}吗？";if(HXWebWorkflowEditor._Internal._options.db_language_type==1){strHintMessage="Are you sure to remove specified workflow node {0}?"}strHintMessage=strHintMessage.replace("{0}",strWorkflowNodeDesc);if(confirm(strHintMessage)==false){return}HXWebWorkflowEditor._DragDropProcess.RemovePrevisousChosenDraggableNode();if(strWorkflowNodeType=="WORKFLOW_PARALLEL__END"){var intRouteCount=parseInt(objHXXmlNodeForWorkflowNode.GetAttributeValue("ROUTE_COUNT"));for(var i=1;i<=intRouteCount;i++){var arrHXXmlNodes=HXWebWorkflowEditor.WorkflowDefinitionUtility._FindAndRemoveWorkflowNodeTargetNodeCodeInfo(strWorkflowNodeCode+","+i);if(arrHXXmlNodes!=null&&arrHXXmlNodes.length>0){for(var j=0;j<arrHXXmlNodes.length;j++){HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(arrHXXmlNodes[j])}}}HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode().RemoveChild(objHXXmlNodeForWorkflowNode);HXWebWorkflowEditor.Utility._RemoveHtmlElementsOfWorkflowNode(strWorkflowNodeCode)}else{if(strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"||strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_OUT"){var intConnectPointNo=parseInt(objHXXmlNodeForWorkflowNode.GetAttributeValue("CONNECT_POINT_NO"));var objHXXmlNode_ConnectPointIn=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectSingleNode("//HXWORKFLOW_NODE[@TYPE='WORKFLOW_CONNECT_POINT_IN' and @CONNECT_POINT_NO="+intConnectPointNo+"]");var objHXXmlNode_ConnectPointOut=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectSingleNode("//HXWORKFLOW_NODE[@TYPE='WORKFLOW_CONNECT_POINT_OUT' and @CONNECT_POINT_NO="+intConnectPointNo+"]");var strTemp=objHXXmlNode_ConnectPointOut.GetAttributeValue("TARGET_NODE_CODE");var blnTempConnectPointHasTargetNode=(strTemp!=null&&strTemp!="");var objTempHXXmlNodeList_WorkflowNodes=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectNodes("//HXWORKFLOW_NODE[.//UI_LINE/@TARGET_CONNECT_POINT_NO="+intConnectPointNo+"]");var objTempHXXmlNodeList_UILines=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectNodes("//UI_LINE[@TARGET_CONNECT_POINT_NO="+intConnectPointNo+"]");for(var i=0;i<objTempHXXmlNodeList_UILines.length;i++){objTempHXXmlNodeList_UILines[i].SetAttributeValue("LINE_END_TARGET_TYPE",(blnTempConnectPointHasTargetNode?"node":""));objTempHXXmlNodeList_UILines[i].SetAttributeValue("TARGET_CONNECT_POINT_NO","");objTempHXXmlNodeList_UILines[i].SetAttributeValue("LINE_END_POSITION","")}for(var i=0;i<objTempHXXmlNodeList_WorkflowNodes.length;i++){HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(objTempHXXmlNodeList_WorkflowNodes[i])}HXWebWorkflowEditor.Utility._RemoveHtmlElementsOfWorkflowNode(objHXXmlNode_ConnectPointIn.GetAttributeValue("CODE"));HXWebWorkflowEditor.Utility._RemoveHtmlElementsOfWorkflowNode(objHXXmlNode_ConnectPointOut.GetAttributeValue("CODE"));HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode().RemoveChild(objHXXmlNode_ConnectPointIn);HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode().RemoveChild(objHXXmlNode_ConnectPointOut)}else{HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode().RemoveChild(objHXXmlNodeForWorkflowNode);HXWebWorkflowEditor.Utility._RemoveHtmlElementsOfWorkflowNode(strWorkflowNodeCode);var arrHXXmlNodes=HXWebWorkflowEditor.WorkflowDefinitionUtility._FindAndRemoveWorkflowNodeTargetNodeCodeInfo(strWorkflowNodeCode);if(arrHXXmlNodes!=null&&arrHXXmlNodes.length>0){for(var i=0;i<arrHXXmlNodes.length;i++){HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(arrHXXmlNodes[i])}}if(strWorkflowNodeType=="WORKFLOW_ACTIVITY"&&HXWebWorkflowEditor._Interface._OnWorkflowActivityRemoved!=null){HXWebWorkflowEditor._Interface._OnWorkflowActivityRemoved(strWorkflowNodeCode,objHXXmlNodeForWorkflowNode)}}}};HXWebWorkflowEditor.CommonElement._CreateWorkflowNodeMainHtmlElement=function(strWorkflowNodeType,strWorkflowNodeCode,objHXXmlNodeForWorkflowNode,objNodeUIPosition,intNodeProcessStatus){var objNodeMainHtmlElement;var strImgIconFileName;var strWorkflowHtmlElementType;if(strWorkflowNodeType=="WORKFLOW_START"||strWorkflowNodeType=="WORKFLOW_END__AGREE"||strWorkflowNodeType=="WORKFLOW_END__REFUSE"){strWorkflowHtmlElementType=(strWorkflowNodeType=="WORKFLOW_START"?"hxworkflowstart":(strWorkflowNodeType=="WORKFLOW_END__AGREE"?"hxworkflowendagree":"hxworkflowendrefuse"));strImgIconFileName=strWorkflowHtmlElementType+(intNodeProcessStatus==0?"":"_finished")+".png";var options={workflow_node_code:strWorkflowNodeCode,workflow_node_status:intNodeProcessStatus,workflow_node_type:strWorkflowNodeType,workflow_html_element_type:strWorkflowHtmlElementType};objNodeMainHtmlElement=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strWorkflowNodeCode+"__img_main",strImgIconFileName,1001,options);objNodeMainHtmlElement.style.left=(objNodeUIPosition.center_x-objNodeUIPosition.width/2)+"px";objNodeMainHtmlElement.style.top=(objNodeUIPosition.center_y-objNodeUIPosition.height/2)+"px";return objNodeMainHtmlElement}if(strWorkflowNodeType=="WORKFLOW_RULE"||strWorkflowNodeType=="WORKFLOW_BRANCH"){strWorkflowHtmlElementType=(strWorkflowNodeType=="WORKFLOW_RULE"?"hxworkflowrule":"hxworkflowbranch");if(strWorkflowNodeType=="WORKFLOW_RULE"){if(intNodeProcessStatus==0){strImgIconFileName=strWorkflowHtmlElementType+".png"}else{var strNodeProcessResult=objHXXmlNodeForWorkflowNode.GetAttributeValue("NODE_PROCESS_RESULT");var blnTemp=(strNodeProcessResult!=null&&strNodeProcessResult!=""&&strNodeProcessResult.toLowerCase()!="true"?false:true);strImgIconFileName=strWorkflowHtmlElementType+"_finished"+(blnTemp?"":"_f")+".png"}}else{strImgIconFileName=strWorkflowHtmlElementType+(intNodeProcessStatus==0?"":"_finished")+".png"}var options={workflow_node_code:strWorkflowNodeCode,workflow_node_status:intNodeProcessStatus,workflow_node_type:strWorkflowNodeType,workflow_html_element_type:strWorkflowHtmlElementType};objNodeMainHtmlElement=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strWorkflowNodeCode+"__img_main",strImgIconFileName,1001,options);objNodeMainHtmlElement.style.left=(objNodeUIPosition.center_x-20)+"px";objNodeMainHtmlElement.style.top=(objNodeUIPosition.center_y-17)+"px";var _div=HXWebWorkflowEditor._Internal._CreateRuleOrBranchTextAreaHtmlElement(strWorkflowNodeCode,objHXXmlNodeForWorkflowNode);_div.style.left=(objNodeUIPosition.center_x-objNodeUIPosition.width/2)+"px";_div.style.top=(objNodeUIPosition.center_y+17)+"px";_div.style.width=objNodeUIPosition.width+"px";_div.style.height="20px";var _img;var intOutletImgX;var intOutletImgY=objNodeUIPosition.center_y+17+20+2;if(strWorkflowNodeType=="WORKFLOW_RULE"){_img=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strWorkflowNodeCode+"__img_outlet_true","outlet_rule_true.png",1001,{workflow_node_code:strWorkflowNodeCode});_img.style.left=(objNodeUIPosition.center_x-objNodeUIPosition.width/2+1)+"px";_img.style.top=intOutletImgY+"px";_img=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strWorkflowNodeCode+"__img_outlet_false","outlet_rule_false.png",1001,{workflow_node_code:strWorkflowNodeCode});_img.style.left=(objNodeUIPosition.center_x+objNodeUIPosition.width/2-8)+"px";_img.style.top=intOutletImgY+"px"}else{var intBranchCount=parseInt(objHXXmlNodeForWorkflowNode.GetAttributeValue("BRANCH_COUNT"));for(var i=1;i<=intBranchCount;i++){if(i==1){intOutletImgX=objNodeUIPosition.center_x-objNodeUIPosition.width/2}else{if(i==intBranchCount){intOutletImgX=objNodeUIPosition.center_x+objNodeUIPosition.width/2-16}else{intOutletImgX=objNodeUIPosition.center_x-objNodeUIPosition.width/2+objNodeUIPosition.width*(i-1)/(intBranchCount-1)-8}}_img=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strWorkflowNodeCode+"__img_outlet_"+i,"outlet_branch_"+i+".png",1001,{workflow_node_code:strWorkflowNodeCode});_img.style.left=intOutletImgX+"px";_img.style.top=intOutletImgY+"px"}}return objNodeMainHtmlElement}if(strWorkflowNodeType=="WORKFLOW_PARALLEL__BEGIN"||strWorkflowNodeType=="WORKFLOW_PARALLEL__END"){var objNodeMainHtmlElement=HXWebWorkflowEditor._Internal._CreateParallelMainHtmlElement(strWorkflowNodeCode,objHXXmlNodeForWorkflowNode,objNodeUIPosition,strWorkflowNodeType=="WORKFLOW_PARALLEL__BEGIN",intNodeProcessStatus);objNodeMainHtmlElement.style.left=(objNodeUIPosition.center_x-objNodeUIPosition.width/2)+"px";objNodeMainHtmlElement.style.top=(objNodeUIPosition.center_y-objNodeUIPosition.height/2)+"px";objNodeMainHtmlElement.style.width=objNodeUIPosition.width+"px";return objNodeMainHtmlElement}if(strWorkflowNodeType=="WORKFLOW_ACTIVITY"){var objNodeMainHtmlElement=HXWebWorkflowEditor._Internal._CreateActivityHtmlElement(strWorkflowNodeCode,objHXXmlNodeForWorkflowNode,objNodeUIPosition,intNodeProcessStatus);objNodeMainHtmlElement.style.left=(objNodeUIPosition.center_x-objNodeUIPosition.width/2)+"px";objNodeMainHtmlElement.style.top=(objNodeUIPosition.center_y-objNodeUIPosition.height/2)+"px";return objNodeMainHtmlElement}if(strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"||strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_OUT"){var objNodeMainHtmlElement=HXWebWorkflowEditor._Internal._CreateConnectPointHtmlElement(strWorkflowNodeCode,objHXXmlNodeForWorkflowNode,objNodeUIPosition,(strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"));return objNodeMainHtmlElement}};HXWebWorkflowEditor._Internal={};HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement=function(strImgHtmlId,strImgFileNameOnly,zIndexValue,customAttributeValues){var editorDIVContainer=HXWebWorkflowEditor._Internal._EditorDivContainerHtmlElement;var _img=document.getElementById(strImgHtmlId);if(_img!=null){return _img}if(zIndexValue==null){zIndexValue=1000}var sb_html=new HXWebStringBuilder();sb_html.append("<img");sb_html.append(' id="'+strImgHtmlId+'"');if(customAttributeValues!=null){if(customAttributeValues.workflow_node_status!=null){sb_html.append(" hx_workflow_node_status="+customAttributeValues.workflow_node_status)}if(customAttributeValues.workflow_node_type!=null){sb_html.append(' hx_workflow_node_type="'+customAttributeValues.workflow_node_type+'"')}if(customAttributeValues.workflow_node_code!=null){sb_html.append(' hx_workflow_node_code="'+customAttributeValues.workflow_node_code+'"')}if(customAttributeValues.workflow_line_type!=null){sb_html.append(' hx_workflow_line_type="'+customAttributeValues.workflow_line_type+'"')}if(customAttributeValues.workflow_line_code!=null){sb_html.append(' hx_workflow_line_code="'+customAttributeValues.workflow_line_code+'"')}if(customAttributeValues.workflow_html_element_type!=null){sb_html.append(' hx_workflow_html_element_type="'+customAttributeValues.workflow_html_element_type+'"')}}sb_html.append(' style="position:absolute;z-index:'+zIndexValue+'"');sb_html.append(' src="../hximages_v6/hxworkflow/'+strImgFileNameOnly+'" />');_img=jQuery(sb_html.toString())[0];editorDIVContainer.appendChild(_img);return _img};HXWebWorkflowEditor._Internal._CreateRuleOrBranchTextAreaHtmlElement=function(strWorkflowNodeCode,objHXXmlNodeForWorkflowNode){var editorDIVContainer=HXWebWorkflowEditor._Internal._EditorDivContainerHtmlElement;var strRuleOrBranchDesc=objHXXmlNodeForWorkflowNode.GetAttributeValue("NODE_NAME"+(HXWebWorkflowEditor._Internal._options.db_language_type==1?"_OT":""));if(strRuleOrBranchDesc==null){strRuleOrBranchDesc=strWorkflowNodeCode}var strDivHtmlId=strWorkflowNodeCode+"__textarea";var _div=document.getElementById(strDivHtmlId);if(_div!=null){jQuery(_div).text(strRuleOrBranchDesc);return _div}var sb_html=new HXWebStringBuilder();sb_html.append("<div");sb_html.append(' id="'+strDivHtmlId+'"');sb_html.append(' style="position:absolute;z-index:1000;border-bottom:1px solid #808080;text-align:center;font-size:12px;"');sb_html.append(' hx_workflow_node_code="'+strWorkflowNodeCode+'">');sb_html.append("</div>");_div=jQuery(sb_html.toString())[0];editorDIVContainer.appendChild(_div);jQuery(_div).text(strRuleOrBranchDesc);return _div};HXWebWorkflowEditor._Internal._CreateActivityHtmlElement=function(strWorkflowNodeCode,objHXXmlNodeForWorkflowNode,objNodeUIPosition,intNodeProcessStatus){var editorDIVContainer=HXWebWorkflowEditor._Internal._EditorDivContainerHtmlElement;var strDivHtmlId=strWorkflowNodeCode+"__activity_div_area";var strActivityDesc=objHXXmlNodeForWorkflowNode.GetAttributeValue("NODE_NAME"+(HXWebWorkflowEditor._Internal._options.db_language_type==1?"_OT":""));var strActivityType=objHXXmlNodeForWorkflowNode.GetAttributeValue("ACTIVITY_TYPE");var strTemp=objHXXmlNodeForWorkflowNode.GetAttributeValue("PROCESS_METHOD__IF_DENY");var intActivityOutletsCount=(strTemp=="-1"?0:2);var sb_html=new HXWebStringBuilder();var _divContainer=document.getElementById(strDivHtmlId);if(_divContainer==null){sb_html.append("<div");sb_html.append(' id="'+strDivHtmlId+'"');sb_html.append(" hx_workflow_node_type='workflow_activity'");sb_html.append(' hx_workflow_node_code="'+strWorkflowNodeCode+'"');sb_html.append(" hx_workflow_html_element_type='hxworkflowactivity_div_area'");sb_html.append(' style="position:absolute;z-index:1000;border:1px solid #808080;height:40px;background-color:white;border-radius:5px;">');sb_html.append("</div>");_divContainer=jQuery(sb_html.toString())[0];editorDIVContainer.appendChild(_divContainer);if(intNodeProcessStatus==1){var strTempBgColor="yellow";if(typeof(WORKFLOW_ACTIVITY_BACKGROUND_COLOR_RUNNING)!="undefined"){strTempBgColor=WORKFLOW_ACTIVITY_BACKGROUND_COLOR_RUNNING}_divContainer.style.backgroundColor=strTempBgColor}else{if(intNodeProcessStatus==2){var strNodeProcessResult=objHXXmlNodeForWorkflowNode.GetAttributeValue("NODE_PROCESS_RESULT");var blnTempIsAgree=(strNodeProcessResult!=null&&strNodeProcessResult!=""&&strNodeProcessResult.toLowerCase()!="accept"&&strNodeProcessResult.toLowerCase()!="true"?false:true);if(blnTempIsAgree){var strTempBgColor="#b4e61d";if(typeof(WORKFLOW_ACTIVITY_BACKGROUND_COLOR_AGREE)!="undefined"){strTempBgColor=WORKFLOW_ACTIVITY_BACKGROUND_COLOR_AGREE}_divContainer.style.backgroundColor=strTempBgColor}else{var strTempBgColor="red";if(typeof(WORKFLOW_ACTIVITY_BACKGROUND_COLOR_DENIED)!="undefined"){strTempBgColor=WORKFLOW_ACTIVITY_BACKGROUND_COLOR_DENIED}_divContainer.style.backgroundColor=strTempBgColor}}}sb_html.clear();sb_html.append("<img id="+strWorkflowNodeCode+"__img_icon");sb_html.append(" hx_workflow_node_type=workflow_activity");sb_html.append(" hx_workflow_node_code="+strWorkflowNodeCode);sb_html.append(" hx_workflow_html_element_type=hxworkflowactivity_icon");sb_html.append(' style="position:absolute;z-index:1005;left:5px;top:5px;"');sb_html.append(' src="../hximages_v6/hxworkflow/hxworflowactivity_icon__'+strActivityType.toLowerCase()+'.png" />');var _imgPicture=jQuery(sb_html.toString())[0];_divContainer.appendChild(_imgPicture);sb_html.clear();sb_html.append("<div id="+strWorkflowNodeCode+"__text_desc_area");sb_html.append(" hx_workflow_node_type=workflow_activity");sb_html.append(" hx_workflow_node_code="+strWorkflowNodeCode);sb_html.append(" hx_workflow_html_element_type=hxworkflowactivity_text_desc_area");sb_html.append(' style="position:absolute;z-index:1005;left:40px;top:'+(intActivityOutletsCount==0?"10":"8")+'px;right:10px;border:none;line-height:20px;height:20px;"');sb_html.append(" ></div>");var _divTextArea=jQuery(sb_html.toString())[0];jQuery(_divTextArea).text(strActivityDesc);_divContainer.appendChild(_divTextArea)}_divContainer.style.width=objNodeUIPosition.width+"px";jQuery("div[hx_workflow_html_element_type=hxworkflowactivity_text_desc_area]",_divContainer).text(strActivityDesc);if(intActivityOutletsCount>0){var _imgOutletAccept=document.getElementById(strWorkflowNodeCode+"__img_outlet_accept");if(_imgOutletAccept==null){var strImgHtmlId=strWorkflowNodeCode+"__img_outlet_accept";var strImgFileNameOnly="outlet_accept.png";_imgOutletAccept=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strImgHtmlId,strImgFileNameOnly,1101,{workflow_node_code:strWorkflowNodeCode});_divContainer.appendChild(_imgOutletAccept)}_imgOutletAccept.style.left=(objNodeUIPosition.width/4-4)+"px";_imgOutletAccept.style.top=(objNodeUIPosition.height-11)+"px";_imgOutletAccept.style.display="";var _imgOutletDeny=document.getElementById(strWorkflowNodeCode+"__img_outlet_deny");if(_imgOutletDeny==null){strImgHtmlId=strWorkflowNodeCode+"__img_outlet_deny";strImgFileNameOnly="outlet_deny.png";_imgOutletDeny=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strImgHtmlId,strImgFileNameOnly,1101,{workflow_node_code:strWorkflowNodeCode});_divContainer.appendChild(_imgOutletDeny)}_imgOutletDeny.style.left=(objNodeUIPosition.width*3/4-4)+"px";_imgOutletDeny.style.top=(objNodeUIPosition.height-11)+"px";_imgOutletDeny.style.display=""}return _divContainer};HXWebWorkflowEditor._Internal._CreateParallelMainHtmlElement=function(strWorkflowNodeCode,objHXXmlNodeForWorkflowNode,objNodeUIPosition,blnIsParallelBegin,intNodeProcessStatus){var editorDIVContainer=HXWebWorkflowEditor._Internal._EditorDivContainerHtmlElement;var strHtmlId=strWorkflowNodeCode+"__parallel_"+(blnIsParallelBegin?"begin":"end")+"__img_main";var _img=document.getElementById(strHtmlId);if(_img!=null){return _img}var strImgIconFileName="hxworkflowparallel_"+(blnIsParallelBegin?"begin":"end")+(intNodeProcessStatus==0?"":(intNodeProcessStatus==1?"_running":"_finished"))+".png";var sb_html=new HXWebStringBuilder();sb_html.append("<img");sb_html.append(' id="'+strHtmlId+'"');sb_html.append(" hx_workflow_node_type=workflow_parallel__"+(blnIsParallelBegin?"begin":"end"));sb_html.append(" hx_workflow_node_code="+strWorkflowNodeCode);sb_html.append(" hx_workflow_html_element_type=hxworkflowparallel_"+(blnIsParallelBegin?"begin":"end"));sb_html.append(' src="../hximages_v6/hxworkflow/'+strImgIconFileName+'"');sb_html.append(' style="position:absolute;z-index:1001;height:8px;" />');_img=jQuery(sb_html.toString())[0];editorDIVContainer.appendChild(_img);return _img};HXWebWorkflowEditor._Internal._CreateConnectPointHtmlElement=function(strWorkflowNodeCode,objHXXmlNodeForWorkflowNode,objNodeUIPosition,blnIsConnectPointIn){var strWorkflowNodeType="workflow_connect_point_"+(blnIsConnectPointIn?"in":"out");var strConnectPointNo=objHXXmlNodeForWorkflowNode.GetAttributeValue("CONNECT_POINT_NO");var strDivHtmlId=strWorkflowNodeCode+"__connect_point_container";var _divContainer=document.getElementById(strDivHtmlId);var sb_html=new HXWebStringBuilder();if(_divContainer==null){sb_html.append('<div id="'+strDivHtmlId+'"');sb_html.append(" hx_workflow_node_type="+strWorkflowNodeType);sb_html.append(" hx_workflow_node_code="+strWorkflowNodeCode);sb_html.append(" hx_workflow_html_element_type=hxworkflowconnectpoint_container");sb_html.append(' style="position:absolute;z-index:1001;width:24px;height:24px;"');sb_html.append("></div>");_divContainer=jQuery(sb_html.toString())[0];HXWebWorkflowEditor._Internal._EditorDivContainerHtmlElement.appendChild(_divContainer);var _imgCircle=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strWorkflowNodeCode+"__connect_point_circle_img","connect_point.png",1002,{workflow_node_type:strWorkflowNodeType,workflow_node_code:strWorkflowNodeCode,workflow_html_element_type:"hxworkflowconnectpoint_img"});_imgCircle.style.left="0px";_imgCircle.style.top="0px";_divContainer.appendChild(_imgCircle);var strTextAreaHtmlId=strWorkflowNodeCode+"__connect_point_textarea";sb_html.clear();sb_html.append('<div id="'+strTextAreaHtmlId+'"');sb_html.append(" hx_workflow_node_type=workflow_connect_point_"+(blnIsConnectPointIn?"in":"out"));sb_html.append(" hx_workflow_node_code="+strWorkflowNodeCode);sb_html.append(" hx_workflow_html_element_type=hxworkflowconnectpoint_textarea");sb_html.append(' style="position:absolute;z-index:1002;text-align:center;font-size:12px;left:3px;top:3px;width:16px;height:16px;line-height:16px;color:#808080;font-weight:bold;"');sb_html.append("></div>");var _divTextArea=jQuery(sb_html.toString())[0];_divContainer.appendChild(_divTextArea)}jQuery(document.getElementById(strWorkflowNodeCode+"__connect_point_textarea")).text(strConnectPointNo);_divContainer.style.left=(objNodeUIPosition.center_x-12)+"px";_divContainer.style.top=(objNodeUIPosition.center_y-12)+"px";return _divContainer};HXWebWorkflowEditor.Utility={};HXWebWorkflowEditor.Utility.ParseStringAsPoint=function(strPointPosition){if(strPointPosition==null||strPointPosition==""){return{x:0,y:0}}var arrTemp=strPointPosition.toString().split(",");if(arrTemp==null||arrTemp.length!=2){return{x:0,y:0}}var intX=parseInt(arrTemp[0]);var intY=parseInt(arrTemp[1]);return{x:(isNaN(intX)?0:intX),y:(isNaN(intY)?0:intY)}};HXWebWorkflowEditor.Utility.ParseStringAsSize=function(strSize){if(strSize==null||strSize==""){return{w:100,h:100}}var arrTemp=strSize.toString().split(",");if(arrTemp==null||arrTemp.length!=2){return{w:100,h:100}}var intW=parseInt(arrTemp[0]);var intH=parseInt(arrTemp[1]);return{w:(isNaN(intW)?100:intW),h:(isNaN(intH)?100:intH)}};HXWebWorkflowEditor.Utility._RemoveHtmlElementsOfWorkflowNode=function(strWorkflowNodeCode){jQuery("[hx_workflow_node_code='"+strWorkflowNodeCode+"']").hide()};HXWebWorkflowEditor.WorkflowDefinitionUtility={};HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode=function(strWorkflowNodeCode){var objHXXmlNodeForWorkflowNode;if(strWorkflowNodeCode==null||strWorkflowNodeCode==""||strWorkflowNodeCode=="hxworkflowstart"){objHXXmlNodeForWorkflowNode=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectSingleNode("//HXWORKFLOW_NODE[@TYPE='WORKFLOW_START']");return objHXXmlNodeForWorkflowNode}else{objHXXmlNodeForWorkflowNode=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectSingleNode("//HXWORKFLOW_NODE[@CODE='"+strWorkflowNodeCode.toLowerCase()+"' or @CODE='"+strWorkflowNodeCode.toUpperCase()+"']");return objHXXmlNodeForWorkflowNode}};HXWebWorkflowEditor.WorkflowDefinitionUtility.GetWorkflowNodeUIData=function(objHXXmlNodeForWorkflowNode){var strTemp=objHXXmlNodeForWorkflowNode.SelectSingleNode(".//UI_DATA/@UI_NODE_CENTER_POINT").GetText();var ptTemp=HXWebWorkflowEditor.Utility.ParseStringAsPoint(strTemp);strTemp=objHXXmlNodeForWorkflowNode.SelectSingleNode(".//UI_DATA/@UI_NODE_SIZE").GetText();var szTemp=HXWebWorkflowEditor.Utility.ParseStringAsSize(strTemp);return{center_x:ptTemp.x,center_y:ptTemp.y,width:szTemp.w,height:szTemp.h}};HXWebWorkflowEditor.WorkflowDefinitionUtility.GetWorkflowNodeListWhichPointToSpecifiedNode=function(strWorkflowNodeCode){var objHXXmlDoc=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow;var sb_xpath=new HXWebStringBuilder();var strWorkflowNodeCode_LowerCase=strWorkflowNodeCode.toLowerCase();var strWorkflowNodeCode_UpperCase=strWorkflowNodeCode.toUpperCase();sb_xpath.append("(@TARGET_NODE_CODE='"+strWorkflowNodeCode_LowerCase+"' or @TARGET_NODE_CODE='"+strWorkflowNodeCode_UpperCase+"')");sb_xpath.append(" or (@TARGET_NODE_CODE__IF_TRUE='"+strWorkflowNodeCode_LowerCase+"' or @TARGET_NODE_CODE__IF_TRUE='"+strWorkflowNodeCode_UpperCase+"')");sb_xpath.append(" or (@TARGET_NODE_CODE__IF_FALSE='"+strWorkflowNodeCode_LowerCase+"' or @TARGET_NODE_CODE__IF_FALSE='"+strWorkflowNodeCode_UpperCase+"')");sb_xpath.append(" or (BRANCH/@TARGET_NODE_CODE='"+strWorkflowNodeCode_LowerCase+"' or BRANCH/@TARGET_NODE_CODE='"+strWorkflowNodeCode_UpperCase+"')");sb_xpath.append(" or (@TARGET_NODE_CODE__IF_ACCEPT='"+strWorkflowNodeCode_LowerCase+"' or @TARGET_NODE_CODE__IF_ACCEPT='"+strWorkflowNodeCode_UpperCase+"')");sb_xpath.append(" or (@TARGET_NODE_CODE__IF_DENY='"+strWorkflowNodeCode_LowerCase+"' or @TARGET_NODE_CODE__IF_DENY='"+strWorkflowNodeCode_UpperCase+"')");sb_xpath.append(" or (ROUTE_OUT/@TARGET_NODE_CODE='"+strWorkflowNodeCode_LowerCase+"' or ROUTE_OUT/@TARGET_NODE_CODE='"+strWorkflowNodeCode_UpperCase+"')");var objHXXmlNodeList=objHXXmlDoc.SelectNodes("//HXWORKFLOW_NODE["+sb_xpath.toString()+"]");return objHXXmlNodeList};HXWebWorkflowEditor.WorkflowDefinitionUtility.UpdateWorkflowNodeUIData=function(strWorkflowNodeCode,ptNewCenterPoint,szNewNodeSize){var objHXXmlNodeForWorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strWorkflowNodeCode);if(objHXXmlNodeForWorkflowNode==null){return}var strTemp;if(ptNewCenterPoint!=null){strTemp=ptNewCenterPoint.x.toString()+","+ptNewCenterPoint.y.toString();objHXXmlNodeForWorkflowNode.SelectSingleNode(".//UI_DATA/@UI_NODE_CENTER_POINT").SetText(strTemp)}if(szNewNodeSize!=null){strTemp=szNewNodeSize.w.toString()+","+szNewNodeSize.h.toString();objHXXmlNodeForWorkflowNode.SelectSingleNode(".//UI_DATA/@UI_NODE_SIZE").SetText(strTemp)}};HXWebWorkflowEditor.WorkflowDefinitionUtility.UpdateWorkflowNodeUILineSetting=function(strWorkflowNodeType,objHXXmlNodeForWorkflowNode,strLineType,ptLineEndPosition,strLineEndArrowDirection,strLineEndTargetType,strTargetConnectPointNo){strWorkflowNodeType=strWorkflowNodeType.toUpperCase();var objHXXmlNodeForUILine;if(strWorkflowNodeType=="WORKFLOW_START"||strWorkflowNodeType=="WORKFLOW_PARALLEL__END"||strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_OUT"){objHXXmlNodeForUILine=objHXXmlNodeForWorkflowNode.SelectSingleNode(".//UI_DATA/UI_LINE")}else{objHXXmlNodeForUILine=objHXXmlNodeForWorkflowNode.SelectSingleNode(".//UI_DATA/UI_LINE[@LINE_TYPE='"+strLineType+"']")}if(objHXXmlNodeForUILine==null){return}var strTemp;if(ptLineEndPosition!=null){strTemp=ptLineEndPosition.x.toString()+","+ptLineEndPosition.y.toString();objHXXmlNodeForUILine.SetAttributeValue("LINE_END_POSITION",strTemp,true)}if(strLineEndArrowDirection!=null&&strLineEndArrowDirection!=""){objHXXmlNodeForUILine.SetAttributeValue("LINE_END_ARROW_DIRECTION",strLineEndArrowDirection,true)}if(strLineEndTargetType!=null){objHXXmlNodeForUILine.SetAttributeValue("LINE_END_TARGET_TYPE",strLineEndTargetType,true)}if(strTargetConnectPointNo!=null){objHXXmlNodeForUILine.SetAttributeValue("TARGET_CONNECT_POINT_NO",strTargetConnectPointNo,true)}};HXWebWorkflowEditor.WorkflowDefinitionUtility._UpdateWorkflowNodeConfigInfo=function(strWorkflowNodeType,objHXXmlNodeForWorkflowNode,objHXWorkflowNodeWithNewConfigInfo){var strWorkflowNodeCode=objHXXmlNodeForWorkflowNode.GetAttributeValue("CODE");objHXXmlNodeForWorkflowNode.SelectSingleNode(".//UI_DATA/@UI_NODE_CENTER_POINT").SetText(objHXWorkflowNodeWithNewConfigInfo.SelectSingleNode(".//UI_DATA/@UI_NODE_CENTER_POINT").GetText());if(strWorkflowNodeType=="WORKFLOW_PARALLEL__BEGIN"||strWorkflowNodeType=="WORKFLOW_PARALLEL__END"||strWorkflowNodeType=="WORKFLOW_RULE"||strWorkflowNodeType=="WORKFLOW_BRANCH"||strWorkflowNodeType=="WORKFLOW_ACTIVITY"){objHXXmlNodeForWorkflowNode.SelectSingleNode(".//UI_DATA/@UI_NODE_SIZE").SetText(objHXWorkflowNodeWithNewConfigInfo.SelectSingleNode(".//UI_DATA/@UI_NODE_SIZE").GetText())}if(strWorkflowNodeType=="WORKFLOW_PARALLEL__BEGIN"){var intOldRouteCount=parseInt(objHXXmlNodeForWorkflowNode.GetAttributeValue("ROUTE_COUNT"));var intNewRouteCount=parseInt(objHXWorkflowNodeWithNewConfigInfo.GetAttributeValue("ROUTE_COUNT"));if(intOldRouteCount!=intNewRouteCount){objHXXmlNodeForWorkflowNode.SetAttributeValue("ROUTE_COUNT",intNewRouteCount);if(intOldRouteCount<intNewRouteCount){var objTempRouteOutNode=objHXXmlNodeForWorkflowNode.SelectSingleNode("ROUTE_OUT[@ID='1']").CloneNode();objTempRouteOutNode.SetAttributeValue("TARGET_NODE_CODE","");var objTempUILineNode=objHXXmlNodeForWorkflowNode.SelectSingleNode(".//UI_LINE[@LINE_TYPE='1']").CloneNode();objTempUILineNode.SetAttributeValue("LINE_END_TARGET_TYPE","");objTempUILineNode.SetAttributeValue("TARGET_CONNECT_POINT_NO","");objTempUILineNode.SetAttributeValue("LINE_END_ARROW_DIRECTION","");objTempUILineNode.SetAttributeValue("LINE_END_POSITION","");for(var i=0;i<intNewRouteCount-intOldRouteCount;i++){objTempRouteOutNode.SetAttributeValue("ID",intOldRouteCount+i+1);objHXXmlNodeForWorkflowNode.AppendChild(objTempRouteOutNode.CloneNode());objTempUILineNode.SetAttributeValue("LINE_TYPE",intOldRouteCount+i+1);objTempUILineNode.SetAttributeValue("CODE",strWorkflowNodeCode+"__line_"+(intOldRouteCount+i+1));objHXXmlNodeForWorkflowNode.SelectSingleNode("UI_DATA").AppendChild(objTempUILineNode.CloneNode())}}else{for(var i=0;i<intOldRouteCount-intNewRouteCount;i++){var objTempRouteOutNode=objHXXmlNodeForWorkflowNode.SelectSingleNode("ROUTE_OUT[@ID='"+(intOldRouteCount-i)+"']");objHXXmlNodeForWorkflowNode.RemoveChild(objTempRouteOutNode);var objTempUILineNode=objHXXmlNodeForWorkflowNode.SelectSingleNode(".//UI_LINE[@LINE_TYPE='"+(intOldRouteCount-i)+"']");var strTempUILineCode=objTempUILineNode.GetAttributeValue("CODE");objHXXmlNodeForWorkflowNode.SelectSingleNode("UI_DATA").RemoveChild(objTempUILineNode);HXWebWorkflowEditor.HXWorkflowConnectionLine._RemoveLine(strTempUILineCode)}}}}if(strWorkflowNodeType=="WORKFLOW_PARALLEL__END"){objHXXmlNodeForWorkflowNode.SetAttributeValue("ROUTE_COUNT",objHXWorkflowNodeWithNewConfigInfo.GetAttributeValue("ROUTE_COUNT"))}if(strWorkflowNodeType=="WORKFLOW_RULE"||strWorkflowNodeType=="WORKFLOW_BRANCH"||strWorkflowNodeType=="WORKFLOW_ACTIVITY"){objHXXmlNodeForWorkflowNode.SetAttributeValue("NODE_NAME",objHXWorkflowNodeWithNewConfigInfo.GetAttributeValue("NODE_NAME"),true);objHXXmlNodeForWorkflowNode.SetAttributeValue("NODE_NAME_OT",objHXWorkflowNodeWithNewConfigInfo.GetAttributeValue("NODE_NAME_OT"),true);objHXXmlNodeForWorkflowNode.SetAttributeValue("EXPRESSION_LANGUAGE",objHXWorkflowNodeWithNewConfigInfo.GetAttributeValue("EXPRESSION_LANGUAGE"),true)}if(strWorkflowNodeType=="WORKFLOW_RULE"||strWorkflowNodeType=="WORKFLOW_BRANCH"){var strDynamicExpressionNodeName=(strWorkflowNodeType=="WORKFLOW_RULE"?"DYNAMIC_EXPRESSION__RULE":"DYNAMIC_EXPRESSION__BRANCH");var strDynamicExpressionContent=objHXWorkflowNodeWithNewConfigInfo.SelectSingleNode(strDynamicExpressionNodeName).GetText();var objHXXmlNode_DynamicExpression=objHXXmlNodeForWorkflowNode.SelectSingleNode(strDynamicExpressionNodeName);if(objHXXmlNode_DynamicExpression==null){objHXXmlNode_DynamicExpression=HXWebJS.Xml.CreateNode("<"+strDynamicExpressionNodeName+" />");objHXXmlNodeForWorkflowNode.AppendChild(objHXXmlNode_DynamicExpression)}objHXXmlNode_DynamicExpression.SetCDATAText(strDynamicExpressionContent)}if(strWorkflowNodeType=="WORKFLOW_BRANCH"){var intOldBranchCount=parseInt(objHXXmlNodeForWorkflowNode.GetAttributeValue("BRANCH_COUNT"));var intNewBranchCount=parseInt(objHXWorkflowNodeWithNewConfigInfo.GetAttributeValue("BRANCH_COUNT"));if(intOldBranchCount!=intNewBranchCount){objHXXmlNodeForWorkflowNode.SetAttributeValue("BRANCH_COUNT",intNewBranchCount);if(intOldBranchCount<intNewBranchCount){var objTempBranchOutNode=objHXXmlNodeForWorkflowNode.SelectSingleNode("BRANCH[@ID='1']").CloneNode();objTempBranchOutNode.SetAttributeValue("TARGET_NODE_CODE","");var objTempUILineNode=objHXXmlNodeForWorkflowNode.SelectSingleNode(".//UI_LINE[@LINE_TYPE='1']").CloneNode();objTempUILineNode.SetAttributeValue("LINE_END_TARGET_TYPE","");objTempUILineNode.SetAttributeValue("TARGET_CONNECT_POINT_NO","");objTempUILineNode.SetAttributeValue("LINE_END_ARROW_DIRECTION","");objTempUILineNode.SetAttributeValue("LINE_END_POSITION","");for(var i=0;i<intNewBranchCount-intOldBranchCount;i++){objTempBranchOutNode.SetAttributeValue("ID",intOldBranchCount+i+1);objHXXmlNodeForWorkflowNode.AppendChild(objTempBranchOutNode.CloneNode());objTempUILineNode.SetAttributeValue("LINE_TYPE",intOldBranchCount+i+1);objTempUILineNode.SetAttributeValue("CODE",strWorkflowNodeCode+"__line_"+(intOldBranchCount+i+1));objHXXmlNodeForWorkflowNode.SelectSingleNode("UI_DATA").AppendChild(objTempUILineNode.CloneNode())}}else{for(var i=0;i<intOldBranchCount-intNewBranchCount;i++){var objTempBranchOutNode=objHXXmlNodeForWorkflowNode.SelectSingleNode("BRANCH[@ID='"+(intOldBranchCount-i)+"']");objHXXmlNodeForWorkflowNode.RemoveChild(objTempBranchOutNode);var objTempUILineNode=objHXXmlNodeForWorkflowNode.SelectSingleNode(".//UI_LINE[@LINE_TYPE='"+(intOldBranchCount-i)+"']");var strTempUILineCode=objTempUILineNode.GetAttributeValue("CODE");objHXXmlNodeForWorkflowNode.SelectSingleNode("UI_DATA").RemoveChild(objTempUILineNode);jQuery("img#"+strWorkflowNodeCode+"__img_outlet_"+(intOldBranchCount-i)).hide();HXWebWorkflowEditor.HXWorkflowConnectionLine._RemoveLine(strTempUILineCode)}}}}if(strWorkflowNodeType=="WORKFLOW_ACTIVITY"){var strNewProcessMethodIfDeny=objHXWorkflowNodeWithNewConfigInfo.GetAttributeValue("PROCESS_METHOD__IF_DENY");if(strNewProcessMethodIfDeny==null||strNewProcessMethodIfDeny==""){strNewProcessMethodIfDeny="0"}var strOldProcessMethodIfDeny=objHXXmlNodeForWorkflowNode.GetAttributeValue("PROCESS_METHOD__IF_DENY");if(strOldProcessMethodIfDeny==null||strOldProcessMethodIfDeny==""){strOldProcessMethodIfDeny="0"}if(strNewProcessMethodIfDeny!=strOldProcessMethodIfDeny){objHXXmlNodeForWorkflowNode.SetAttributeValue("PROCESS_METHOD__IF_DENY",strNewProcessMethodIfDeny,true);if(strOldProcessMethodIfDeny=="0"){var objTempUILineNode=objHXXmlNodeForWorkflowNode.SelectSingleNode(".//UI_LINE[@LINE_TYPE='deny']");if(objTempUILineNode!=null){var strTempUILineCode=objTempUILineNode.GetAttributeValue("CODE");objHXXmlNodeForWorkflowNode.SelectSingleNode("UI_DATA").RemoveChild(objTempUILineNode);HXWebWorkflowEditor.HXWorkflowConnectionLine._RemoveLine(strTempUILineCode)}if(strNewProcessMethodIfDeny=="-1"){jQuery("img#"+strWorkflowNodeCode+"__img_outlet_accept").hide();jQuery("img#"+strWorkflowNodeCode+"__img_outlet_deny").hide()}objHXXmlNodeForWorkflowNode.SetAttributeValue("TARGET_NODE_CODE__IF_DENY","")}else{if(strNewProcessMethodIfDeny=="0"){var objTempUILineNode=objHXXmlNodeForWorkflowNode.SelectSingleNode(".//UI_LINE[@LINE_TYPE='accept']").CloneNode();objTempUILineNode.SetAttributeValue("LINE_END_TARGET_TYPE","",true);objTempUILineNode.SetAttributeValue("TARGET_CONNECT_POINT_NO","",true);objTempUILineNode.SetAttributeValue("LINE_END_ARROW_DIRECTION","",true);objTempUILineNode.SetAttributeValue("LINE_END_POSITION","",true);objTempUILineNode.SetAttributeValue("LINE_TYPE","deny",true);objTempUILineNode.SetAttributeValue("CODE",strWorkflowNodeCode.toLowerCase()+"__line_deny");objHXXmlNodeForWorkflowNode.SelectSingleNode("UI_DATA").AppendChild(objTempUILineNode)}}}var strAcitivityType=objHXXmlNodeForWorkflowNode.GetAttributeValue("ACTIVITY_TYPE").toUpperCase();objHXXmlNodeForWorkflowNode.SetAttributeValue(strAcitivityType+"__CHOSEN_METHOD",objHXWorkflowNodeWithNewConfigInfo.GetAttributeValue(strAcitivityType+"__CHOSEN_METHOD"),true);objHXXmlNodeForWorkflowNode.SetAttributeValue(strAcitivityType+"__CHOSEN_CODE_TYPE",objHXWorkflowNodeWithNewConfigInfo.GetAttributeValue(strAcitivityType+"__CHOSEN_CODE_TYPE"),true);objHXXmlNodeForWorkflowNode.SetAttributeValue(strAcitivityType+"__CHOSEN_CODE",objHXWorkflowNodeWithNewConfigInfo.GetAttributeValue(strAcitivityType+"__CHOSEN_CODE"),true);objHXXmlNodeForWorkflowNode.SetAttributeValue(strAcitivityType+"__CHOSEN_NAME",objHXWorkflowNodeWithNewConfigInfo.GetAttributeValue(strAcitivityType+"__CHOSEN_NAME"),true);objHXXmlNodeForWorkflowNode.SetAttributeValue(strAcitivityType+"__CHOSEN_NAME_OT",objHXWorkflowNodeWithNewConfigInfo.GetAttributeValue(strAcitivityType+"__CHOSEN_NAME_OT"),true);if(strAcitivityType=="APPROVE_GROUP"){objHXXmlNodeForWorkflowNode.SetAttributeValue("APPROVE_GROUP__DECISION_POLICY",objHXWorkflowNodeWithNewConfigInfo.GetAttributeValue("APPROVE_GROUP__DECISION_POLICY"),true)}var strDynamicExpressionNodeName="DYNAMIC_EXPRESSION__"+strAcitivityType;var objTempHXXmlNode=objHXWorkflowNodeWithNewConfigInfo.SelectSingleNode(strDynamicExpressionNodeName);var strDynamicExpressionContent=(objTempHXXmlNode!=null?objTempHXXmlNode.GetText():"");var objHXXmlNode_DynamicExpression=objHXXmlNodeForWorkflowNode.SelectSingleNode(strDynamicExpressionNodeName);if(objHXXmlNode_DynamicExpression==null){objHXXmlNode_DynamicExpression=HXWebJS.Xml.CreateNode("<"+strDynamicExpressionNodeName+" />");objHXXmlNodeForWorkflowNode.AppendChild(objHXXmlNode_DynamicExpression)}objHXXmlNode_DynamicExpression.SetCDATAText(strDynamicExpressionContent);var arrNodeAttributeName=["APPROVE_STEP__AUTO_PASS_IF_REPEAT_REPLY","APPROVE_STEP__AUTO_PASS_IF_RULE_MATCH","APPROVE_STEP__AUTO_PASS_RULE_EXPRESSION","COUNTERSIGN_OPTION","COUNTERSIGN_FINISH_OPTIONS","NODE_ATTR_1","NODE_ATTR_2","NODE_ATTR_3","NODE_ATTR_4","NODE_ATTR_5"];for(var i=0;i<arrNodeAttributeName.length;i++){var strTempNodeAttributeName=arrNodeAttributeName[i];objTempHXXmlNode=objHXWorkflowNodeWithNewConfigInfo.SelectSingleNode("@"+strTempNodeAttributeName);if(objTempHXXmlNode!=null){objHXXmlNodeForWorkflowNode.SetAttributeValue(strTempNodeAttributeName,objTempHXXmlNode.GetText(),true)}}var strNewWorkflowNodeCode=objHXWorkflowNodeWithNewConfigInfo.GetAttributeValue("NEW_WORKFLOW_CODE");if(strNewWorkflowNodeCode!=null&&strNewWorkflowNodeCode!=""&&strNewWorkflowNodeCode.toLowerCase()!=strWorkflowNodeCode.toLowerCase()){strNewWorkflowNodeCode=strNewWorkflowNodeCode.toLowerCase();if(HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectSingleNode("//HXWORKFLOW_NODE[@CODE='"+strNewWorkflowNodeCode+"' or @CODE='"+strNewWorkflowNodeCode.toUpperCase()+"']")!=null){alert("对不起，工作流程节点代码不允许重复！你指定的新活动节点代码"+strNewWorkflowNodeCode+"在流程中已经存在。当前活动节点代码值将保持不变。")}else{HXWebWorkflowEditor.WorkflowDefinitionUtility._ChangeWorkflowActivityNodeCodeProcess(objHXXmlNodeForWorkflowNode,strWorkflowNodeCode,strNewWorkflowNodeCode)}}if(HXWebWorkflowEditor.Extend.OnWorkflowActivityAfterConfigChanged!=null){HXWebWorkflowEditor.Extend.OnWorkflowActivityAfterConfigChanged(HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow,objHXXmlNodeForWorkflowNode,objHXWorkflowNodeWithNewConfigInfo)}}};HXWebWorkflowEditor.Interface.UpdateWorkflowActivityConfigInfo=function(strWorkflowActivityNodeCode,strXmlWorkflowActivityNodeNewConfigInfo){var objHXWorkflowNodeWithNewConfigInfo=HXWebJS.Xml.GetHXXmlDocumentViaXmlString(strXmlWorkflowActivityNodeNewConfigInfo).GetRootXmlNode();var objHXXmlNodeForWorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strWorkflowActivityNodeCode);if(objHXXmlNodeForWorkflowNode==null){return}HXWebWorkflowEditor.WorkflowDefinitionUtility._UpdateWorkflowNodeConfigInfo("WORKFLOW_ACTIVITY",objHXXmlNodeForWorkflowNode,objHXWorkflowNodeWithNewConfigInfo);HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(objHXXmlNodeForWorkflowNode);var objHXXmlNodeList=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetWorkflowNodeListWhichPointToSpecifiedNode(strWorkflowActivityNodeCode);for(var i=0;i<objHXXmlNodeList.length;i++){HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(objHXXmlNodeList[i].GetAttributeValue("CODE"))}strWorkflowActivityNodeCode=objHXXmlNodeForWorkflowNode.GetAttributeValue("CODE");HXWebWorkflowEditor._DragDropProcess.MarkWorkflowNodeAsDraggable(strWorkflowActivityNodeCode,true)};HXWebWorkflowEditor.WorkflowDefinitionUtility._ChangeWorkflowActivityNodeCodeProcess=function(objHXXmlNodeForWorkflowNode,strWorkflowNodeCode,strNewWorkflowNodeCode){objHXXmlNodeForWorkflowNode.SetAttributeValue("CODE",strNewWorkflowNodeCode);var objTempHXXmlNode=objHXXmlNodeForWorkflowNode.SelectSingleNode("UI_DATA/UI_LINE[@CODE='"+strWorkflowNodeCode+"__line_accept']");if(objTempHXXmlNode!=null){objTempHXXmlNode.SetAttributeValue("CODE",strNewWorkflowNodeCode+"__line_accept")}objTempHXXmlNode=objHXXmlNodeForWorkflowNode.SelectSingleNode("UI_DATA/UI_LINE[@CODE='"+strWorkflowNodeCode+"__line_deny']");if(objTempHXXmlNode!=null){objTempHXXmlNode.SetAttributeValue("CODE",strNewWorkflowNodeCode+"__line_deny")}var arr_TempElements=jQuery("[hx_workflow_node_code='"+strWorkflowNodeCode+"']");var objTempHtmlElement,strTempHtmlId,strTemp;for(var i=0;i<arr_TempElements.length;i++){objTempHtmlElement=arr_TempElements[i];strTempHtmlId=objTempHtmlElement.id;if(strTempHtmlId.indexOf(strWorkflowNodeCode)==0){strTempHtmlId=strTempHtmlId.replace(strWorkflowNodeCode,strNewWorkflowNodeCode);objTempHtmlElement.id=strTempHtmlId}strTemp=jQuery(objTempHtmlElement).attr("hx_workflow_line_code");if(strTemp!=null&&strTemp.indexOf(strWorkflowNodeCode)==0){jQuery(objTempHtmlElement).attr("hx_workflow_line_code",strTemp.replace(strWorkflowNodeCode,strNewWorkflowNodeCode))}jQuery(objTempHtmlElement).attr("hx_workflow_node_code",strNewWorkflowNodeCode)}var objHXXmlDoc=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow;var objHXXmlNodeList=objHXXmlDoc.SelectNodes("//HXWORKFLOW_NODE[(@TYPE='WORKFLOW_START' or @TYPE='WORKFLOW_CONNECT_POINT_OUT' or @TYPE='WORKFLOW_PARALLEL__END') and (@TARGET_NODE_CODE='"+strWorkflowNodeCode.toLowerCase()+"' or @TARGET_NODE_CODE='"+strWorkflowNodeCode.toUpperCase()+"')]");for(var i=0;i<objHXXmlNodeList.length;i++){objHXXmlNodeList[i].SetAttributeValue("TARGET_NODE_CODE",strNewWorkflowNodeCode,true)}objHXXmlNodeList=objHXXmlDoc.SelectNodes("//HXWORKFLOW_NODE[@TYPE='WORKFLOW_RULE' and (@TARGET_NODE_CODE__IF_TRUE='"+strWorkflowNodeCode.toLowerCase()+"' or @TARGET_NODE_CODE__IF_TRUE='"+strWorkflowNodeCode.toUpperCase()+"')]");for(var i=0;i<objHXXmlNodeList.length;i++){objHXXmlNodeList[i].SetAttributeValue("TARGET_NODE_CODE__IF_TRUE",strNewWorkflowNodeCode,true)}objHXXmlNodeList=objHXXmlDoc.SelectNodes("//HXWORKFLOW_NODE[@TYPE='WORKFLOW_RULE' and (@TARGET_NODE_CODE__IF_FALSE='"+strWorkflowNodeCode.toLowerCase()+"' or @TARGET_NODE_CODE__IF_FALSE='"+strWorkflowNodeCode.toUpperCase()+"')]");for(var i=0;i<objHXXmlNodeList.length;i++){objHXXmlNodeList[i].SetAttributeValue("TARGET_NODE_CODE__IF_FALSE",strNewWorkflowNodeCode,true)}objHXXmlNodeList=objHXXmlDoc.SelectNodes("//HXWORKFLOW_NODE[@TYPE='WORKFLOW_ACTIVITY' and (@TARGET_NODE_CODE__IF_ACCEPT='"+strWorkflowNodeCode.toLowerCase()+"' or @TARGET_NODE_CODE__IF_ACCEPT='"+strWorkflowNodeCode.toUpperCase()+"')]");for(var i=0;i<objHXXmlNodeList.length;i++){objHXXmlNodeList[i].SetAttributeValue("TARGET_NODE_CODE__IF_ACCEPT",strNewWorkflowNodeCode,true)}objHXXmlNodeList=objHXXmlDoc.SelectNodes("//HXWORKFLOW_NODE[@TYPE='WORKFLOW_ACTIVITY' and (@TARGET_NODE_CODE__IF_DENY='"+strWorkflowNodeCode.toLowerCase()+"' or @TARGET_NODE_CODE__IF_DENY='"+strWorkflowNodeCode.toUpperCase()+"')]");for(var i=0;i<objHXXmlNodeList.length;i++){objHXXmlNodeList[i].SetAttributeValue("TARGET_NODE_CODE__IF_DENY",strNewWorkflowNodeCode,true)}objHXXmlNodeList=objHXXmlDoc.SelectNodes("//HXWORKFLOW_NODE[@TYPE='WORKFLOW_BRANCH']/BRANCH[(@TARGET_NODE_CODE='"+strWorkflowNodeCode.toLowerCase()+"' or @TARGET_NODE_CODE='"+strWorkflowNodeCode.toUpperCase()+"')]");for(var i=0;i<objHXXmlNodeList.length;i++){objHXXmlNodeList[i].SetAttributeValue("TARGET_NODE_CODE",strNewWorkflowNodeCode,true)}objHXXmlNodeList=objHXXmlDoc.SelectNodes("//HXWORKFLOW_NODE[@TYPE='WORKFLOW_PARALLEL__BEGIN']/ROUTE_OUT[(@TARGET_NODE_CODE='"+strWorkflowNodeCode.toLowerCase()+"' or @TARGET_NODE_CODE='"+strWorkflowNodeCode.toUpperCase()+"')]");for(var i=0;i<objHXXmlNodeList.length;i++){objHXXmlNodeList[i].SetAttributeValue("TARGET_NODE_CODE",strNewWorkflowNodeCode,true)}};HXWebWorkflowEditor.WorkflowDefinitionUtility._UpdateWorkflowStartNodeAndExtensionConfigInfo=function(objHXXmlNodeForWorkflowNode,objNewWorkflowStartNodeAndExtensionNode){var strWorkflowNodeCode=objHXXmlNodeForWorkflowNode.GetAttributeValue("CODE");objHXXmlNodeForWorkflowNode.SelectSingleNode(".//UI_DATA/@UI_NODE_CENTER_POINT").SetText(objNewWorkflowStartNodeAndExtensionNode.SelectSingleNode(".//HXWORKFLOW_NODE[@TYPE='WORKFLOW_START']//UI_DATA/@UI_NODE_CENTER_POINT").GetText());HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(objHXXmlNodeForWorkflowNode);HXWebWorkflowEditor._DragDropProcess.MarkWorkflowNodeAsDraggable(strWorkflowNodeCode,true);var objHXXmlDoc=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow;var objTempHXXmlNode=objHXXmlDoc.SelectSingleNode("//HXWORKFLOW_EXTENSION__HXAPPROVEWORKFLOW");if(objTempHXXmlNode==null){objTempHXXmlNode=HXWebJS.Xml.CreateNode("<HXWORKFLOW_EXTENSION__HXAPPROVEWORKFLOW><NOTIFICATION_USERS><DYNAMIC_EXPRESSION__NOTIFICATION_USERS /></NOTIFICATION_USERS></HXWORKFLOW_EXTENSION__HXAPPROVEWORKFLOW>");objHXXmlDoc.GetRootXmlNode().AppendChild(objTempHXXmlNode)}var objHXXmlNode_NotificationUsers=objHXXmlDoc.SelectSingleNode("//HXWORKFLOW_EXTENSION__HXAPPROVEWORKFLOW/NOTIFICATION_USERS");if(objHXXmlNode_NotificationUsers==null){objHXXmlNode_NotificationUsers=HXWebJS.Xml.CreateNode("<NOTIFICATION_USERS><DYNAMIC_EXPRESSION__NOTIFICATION_USERS /></NOTIFICATION_USERS>");objHXXmlDoc.SelectSingleNode("//HXWORKFLOW_EXTENSION__HXAPPROVEWORKFLOW").AppendChild(objHXXmlNode_NotificationUsers)}var objHXXmlNode_NotificationUsers_New=objNewWorkflowStartNodeAndExtensionNode.SelectSingleNode("//HXWORKFLOW_EXTENSION__HXAPPROVEWORKFLOW/NOTIFICATION_USERS");objHXXmlNode_NotificationUsers.SetAttributeValue("CHOSEN_METHOD",objHXXmlNode_NotificationUsers_New.GetAttributeValue("CHOSEN_METHOD"),true);objHXXmlNode_NotificationUsers.SetAttributeValue("CHOSEN_CODE_TYPE",objHXXmlNode_NotificationUsers_New.GetAttributeValue("CHOSEN_CODE_TYPE"),true);objHXXmlNode_NotificationUsers.SetAttributeValue("CHOSEN_CODE",objHXXmlNode_NotificationUsers_New.GetAttributeValue("CHOSEN_CODE"),true);objHXXmlNode_NotificationUsers.SetAttributeValue("CHOSEN_NAME",objHXXmlNode_NotificationUsers_New.GetAttributeValue("CHOSEN_NAME"),true);objHXXmlNode_NotificationUsers.SetAttributeValue("CHOSEN_NAME_OT",objHXXmlNode_NotificationUsers_New.GetAttributeValue("CHOSEN_NAME_OT"),true);objTempHXXmlNode=objHXXmlNode_NotificationUsers_New.SelectSingleNode("DYNAMIC_EXPRESSION__NOTIFICATION_USERS");var strDynamicExpressionContent=(objTempHXXmlNode!=null?objTempHXXmlNode.GetText():"");var objHXXmlNode_DynamicExpression=objHXXmlNode_NotificationUsers.SelectSingleNode("DYNAMIC_EXPRESSION__NOTIFICATION_USERS");if(objHXXmlNode_DynamicExpression==null){objHXXmlNode_DynamicExpression=HXWebJS.Xml.CreateNode("<DYNAMIC_EXPRESSION__NOTIFICATION_USERS />");objHXXmlNode_NotificationUsers.AppendChild(objHXXmlNode_DynamicExpression)}objHXXmlNode_DynamicExpression.SetCDATAText(strDynamicExpressionContent)};HXWebWorkflowEditor.WorkflowDefinitionUtility._CalculateAndGetUILinePointAndColorInfo=function(strWorkflowNodeType,objHXXmlNodeForWorkflowNode,objNodeUIPosition,objHXXmlNode_UILine,strLineCode){var strLineType=objHXXmlNode_UILine.GetAttributeValue("LINE_TYPE");var strLineEngTargetType=objHXXmlNode_UILine.GetAttributeValue("LINE_END_TARGET_TYPE");if(strLineEngTargetType==null){strLineEngTargetType=""}else{strLineEngTargetType=strLineEngTargetType.toLowerCase()}var strTargetConnectPointNo=objHXXmlNode_UILine.GetAttributeValue("TARGET_CONNECT_POINT_NO");if(strTargetConnectPointNo==null){strTargetConnectPointNo=""}var strLineEndArrowDirection=objHXXmlNode_UILine.GetAttributeValue("LINE_END_ARROW_DIRECTION");if(strLineEndArrowDirection==null||strLineEndArrowDirection==""){strLineEndArrowDirection="to_bottom"}else{strLineEndArrowDirection=strLineEndArrowDirection.toLowerCase()}var objLineDrawInfo={line_color:"gray",begin_x:0,begin_y:0,end_x:30,end_y:30,line_end_arrow_direction:strLineEndArrowDirection};if(strWorkflowNodeType=="WORKFLOW_START"){objLineDrawInfo.line_color="green";objLineDrawInfo.begin_x=objNodeUIPosition.center_x;objLineDrawInfo.begin_y=objNodeUIPosition.center_y+15}else{if(strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_OUT"){objLineDrawInfo.begin_x=objNodeUIPosition.center_x;objLineDrawInfo.begin_y=objNodeUIPosition.center_y+12}else{if(strWorkflowNodeType=="WORKFLOW_RULE"){objLineDrawInfo.line_color=(strLineType=="true"?"blue":"orange");objLineDrawInfo.begin_y=objNodeUIPosition.center_y+17+20+16;if(strLineType=="true"){objLineDrawInfo.begin_x=objNodeUIPosition.center_x-objNodeUIPosition.width/2+4}else{objLineDrawInfo.begin_x=objNodeUIPosition.center_x+objNodeUIPosition.width/2-4}}else{if(strWorkflowNodeType=="WORKFLOW_BRANCH"){var intBranchCount=parseInt(objHXXmlNodeForWorkflowNode.GetAttributeValue("BRANCH_COUNT"));objLineDrawInfo.begin_y=objNodeUIPosition.center_y+17+20+17;if(strLineType=="1"){objLineDrawInfo.begin_x=objNodeUIPosition.center_x-objNodeUIPosition.width/2+8}else{if(parseInt(strLineType)>=intBranchCount){objLineDrawInfo.begin_x=objNodeUIPosition.center_x+objNodeUIPosition.width/2-8}else{var intTemp=parseInt(strLineType)-1;objLineDrawInfo.begin_x=objNodeUIPosition.center_x-objNodeUIPosition.width/2+objNodeUIPosition.width*intTemp/(intBranchCount-1)}}}else{if(strWorkflowNodeType=="WORKFLOW_PARALLEL__BEGIN"){var intRouteCount=parseInt(objHXXmlNodeForWorkflowNode.GetAttributeValue("ROUTE_COUNT"));objLineDrawInfo.begin_y=objNodeUIPosition.center_y+4;if(strLineType=="1"){objLineDrawInfo.begin_x=objNodeUIPosition.center_x-objNodeUIPosition.width/2+6}else{if(parseInt(strLineType)>=intRouteCount){objLineDrawInfo.begin_x=objNodeUIPosition.center_x+objNodeUIPosition.width/2-8}else{var intTemp=parseInt(strLineType)-1;objLineDrawInfo.begin_x=objNodeUIPosition.center_x-objNodeUIPosition.width/2+objNodeUIPosition.width*intTemp/(intRouteCount-1)}}}else{if(strWorkflowNodeType=="WORKFLOW_PARALLEL__END"){objLineDrawInfo.begin_x=objNodeUIPosition.center_x;objLineDrawInfo.begin_y=objNodeUIPosition.center_y+4}else{if(strWorkflowNodeType=="WORKFLOW_ACTIVITY"){objLineDrawInfo.begin_y=objNodeUIPosition.center_y+objNodeUIPosition.height/2;var strTemp=objHXXmlNodeForWorkflowNode.GetAttributeValue("PROCESS_METHOD__IF_DENY");if(strTemp=="-1"){objLineDrawInfo.begin_x=objNodeUIPosition.center_x}else{if(strLineType=="accept"){objLineDrawInfo.begin_x=objNodeUIPosition.center_x-objNodeUIPosition.width/4}else{objLineDrawInfo.begin_x=objNodeUIPosition.center_x+objNodeUIPosition.width/4}}objLineDrawInfo.line_color=(strLineType=="accept"?"blue":"orange")}}}}}}}if(strLineEngTargetType==""){var strTemp=objHXXmlNode_UILine.GetAttributeValue("LINE_END_POSITION");var ptTempLineEndPosition;if(strTemp!=null&&strTemp!=""){ptTempLineEndPosition=HXWebWorkflowEditor.Utility.ParseStringAsPoint(strTemp);objLineDrawInfo.end_x=ptTempLineEndPosition.x;objLineDrawInfo.end_y=ptTempLineEndPosition.y}else{objLineDrawInfo.end_x=objLineDrawInfo.begin_x;objLineDrawInfo.end_y=objLineDrawInfo.begin_y+40}}else{if(strLineEngTargetType=="connect_point"){var objHXXmlNode_ConnectPointInDefinition=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectSingleNode("//HXWORKFLOW_NODE[@TYPE='WORKFLOW_CONNECT_POINT_IN' and @CONNECT_POINT_NO='"+strTargetConnectPointNo+"']");if(objHXXmlNode_ConnectPointInDefinition==null){throw"连接点元素("+strTargetConnectPointNo+")未定义！"}strTemp=objHXXmlNode_ConnectPointInDefinition.SelectSingleNode(".//UI_DATA/@UI_NODE_CENTER_POINT").GetText();var ptTempConnectPointCenter=HXWebWorkflowEditor.Utility.ParseStringAsPoint(strTemp);objLineDrawInfo.end_x=ptTempConnectPointCenter.x;objLineDrawInfo.end_y=ptTempConnectPointCenter.y-12}else{var strTargetWorkflowNodeCode=HXWebWorkflowEditor.WorkflowDefinitionUtility._GetTargetNodeCodeViaLineType(strWorkflowNodeType,objHXXmlNodeForWorkflowNode,strLineType);var ptTemp=HXWebWorkflowEditor.WorkflowDefinitionUtility._GetLinePointToTargetNodePosition(strTargetWorkflowNodeCode,strLineEndArrowDirection);objLineDrawInfo.end_x=ptTemp.x;objLineDrawInfo.end_y=ptTemp.y}}return objLineDrawInfo};HXWebWorkflowEditor.WorkflowDefinitionUtility._GetTargetNodeCodeViaLineType=function(strWorkflowNodeType,objHXXmlNodeForWorkflowNode,strLineType){if(strWorkflowNodeType=="WORKFLOW_START"||strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_OUT"){return objHXXmlNodeForWorkflowNode.GetAttributeValue("TARGET_NODE_CODE")}if(strWorkflowNodeType=="WORKFLOW_RULE"){return objHXXmlNodeForWorkflowNode.GetAttributeValue(strLineType=="true"?"TARGET_NODE_CODE__IF_TRUE":"TARGET_NODE_CODE__IF_FALSE")}if(strWorkflowNodeType=="WORKFLOW_BRANCH"){return objHXXmlNodeForWorkflowNode.SelectSingleNode("BRANCH[@ID="+strLineType+"]/@TARGET_NODE_CODE").GetText()}if(strWorkflowNodeType=="WORKFLOW_ACTIVITY"){return objHXXmlNodeForWorkflowNode.GetAttributeValue(strLineType=="accept"?"TARGET_NODE_CODE__IF_ACCEPT":"TARGET_NODE_CODE__IF_DENY")}if(strWorkflowNodeType=="WORKFLOW_PARALLEL__BEGIN"){return objHXXmlNodeForWorkflowNode.SelectSingleNode("ROUTE_OUT[@ID="+strLineType+"]/@TARGET_NODE_CODE").GetText()}if(strWorkflowNodeType=="WORKFLOW_PARALLEL__END"){return objHXXmlNodeForWorkflowNode.GetAttributeValue("TARGET_NODE_CODE")}};HXWebWorkflowEditor.WorkflowDefinitionUtility._UpdateTargetNodeCodeViaLineType=function(strWorkflowNodeType,objHXXmlNodeForWorkflowNode,strLineType,strTargetWorkflowNodeCode){strWorkflowNodeType=strWorkflowNodeType.toUpperCase();if(strWorkflowNodeType=="WORKFLOW_START"){objHXXmlNodeForWorkflowNode.SetAttributeValue("TARGET_NODE_CODE",strTargetWorkflowNodeCode,true);return}if(strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_OUT"){objHXXmlNodeForWorkflowNode.SetAttributeValue("TARGET_NODE_CODE",strTargetWorkflowNodeCode,true);var strConnectPointNo=objHXXmlNodeForWorkflowNode.GetAttributeValue("CONNECT_POINT_NO");var objHXXmlNodeList_UILinesToConnectPoint=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectNodes("//UI_LINE[@LINE_END_TARGET_TYPE='connect_point' and @TARGET_CONNECT_POINT_NO='"+strConnectPointNo+"']");var objTempHXXmlNode_UILine,objTempHXXmlNode_WorkflowNode;var strTempWorkflowNodeType,strTempLineType;for(var i=0;i<objHXXmlNodeList_UILinesToConnectPoint.length;i++){objTempHXXmlNode_UILine=objHXXmlNodeList_UILinesToConnectPoint[i];strTempLineType=objTempHXXmlNode_UILine.GetAttributeValue("LINE_TYPE");objTempHXXmlNode_WorkflowNode=objTempHXXmlNode_UILine.SelectSingleNode("../..");strTempWorkflowNodeType=objTempHXXmlNode_WorkflowNode.GetAttributeValue("TYPE");HXWebWorkflowEditor.WorkflowDefinitionUtility._UpdateTargetNodeCodeViaLineType(strTempWorkflowNodeType,objTempHXXmlNode_WorkflowNode,strTempLineType,strTargetWorkflowNodeCode)}return}if(strWorkflowNodeType=="WORKFLOW_RULE"){objHXXmlNodeForWorkflowNode.SetAttributeValue(strLineType=="true"?"TARGET_NODE_CODE__IF_TRUE":"TARGET_NODE_CODE__IF_FALSE",strTargetWorkflowNodeCode,true);return}if(strWorkflowNodeType=="WORKFLOW_BRANCH"){objHXXmlNodeForWorkflowNode.SelectSingleNode("BRANCH[@ID="+strLineType+"]/@TARGET_NODE_CODE").SetText(strTargetWorkflowNodeCode);return}if(strWorkflowNodeType=="WORKFLOW_ACTIVITY"){objHXXmlNodeForWorkflowNode.SetAttributeValue(strLineType=="accept"?"TARGET_NODE_CODE__IF_ACCEPT":"TARGET_NODE_CODE__IF_DENY",strTargetWorkflowNodeCode,true);return}if(strWorkflowNodeType=="WORKFLOW_PARALLEL__BEGIN"){objHXXmlNodeForWorkflowNode.SelectSingleNode("ROUTE_OUT[@ID="+strLineType+"]/@TARGET_NODE_CODE").SetText(strTargetWorkflowNodeCode);return}if(strWorkflowNodeType=="WORKFLOW_PARALLEL__END"){objHXXmlNodeForWorkflowNode.SetAttributeValue("TARGET_NODE_CODE",strTargetWorkflowNodeCode,true);return}};HXWebWorkflowEditor.WorkflowDefinitionUtility._GetLinePointToTargetNodePosition=function(strTargetWorkflowNodeCode,strLineEndArrowDirection){var intTargetParallelEndNodeRouteId=0;var strTemp;if(strTargetWorkflowNodeCode.indexOf(",")!=-1){strTemp=strTargetWorkflowNodeCode.substr(strTargetWorkflowNodeCode.length-1);intTargetParallelEndNodeRouteId=parseInt(strTemp);strTargetWorkflowNodeCode=strTargetWorkflowNodeCode.substr(0,strTargetWorkflowNodeCode.length-2)}var objHXXmlNode_TargetWorkflowNode=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectSingleNode("//HXWORKFLOW_NODE[@CODE='"+strTargetWorkflowNodeCode.toLowerCase()+"' or @CODE='"+strTargetWorkflowNodeCode.toUpperCase()+"']");var strTargetWorkflowNodeType=objHXXmlNode_TargetWorkflowNode.GetAttributeValue("TYPE");var objTargetNodeConnectAreaUIPosition=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetWorkflowNodeUIData(objHXXmlNode_TargetWorkflowNode);var ptTemp={x:0,y:0};if(strTargetWorkflowNodeType=="WORKFLOW_PARALLEL__END"){var intRouteCount=parseInt(objHXXmlNode_TargetWorkflowNode.GetAttributeValue("ROUTE_COUNT"));ptTemp.y=objTargetNodeConnectAreaUIPosition.center_y-objTargetNodeConnectAreaUIPosition.height/2;if(intTargetParallelEndNodeRouteId==1){ptTemp.x=objTargetNodeConnectAreaUIPosition.center_x-objTargetNodeConnectAreaUIPosition.width/2+8}else{if(intTargetParallelEndNodeRouteId>=intRouteCount){ptTemp.x=objTargetNodeConnectAreaUIPosition.center_x+objTargetNodeConnectAreaUIPosition.width/2-8}else{ptTemp.x=objTargetNodeConnectAreaUIPosition.center_x-objTargetNodeConnectAreaUIPosition.width/2+objTargetNodeConnectAreaUIPosition.width*(intTargetParallelEndNodeRouteId-1)/(intRouteCount-1)}}return ptTemp}if(strTargetWorkflowNodeType=="WORKFLOW_RULE"||strTargetWorkflowNodeType=="WORKFLOW_BRANCH"){objTargetNodeConnectAreaUIPosition.width=40;objTargetNodeConnectAreaUIPosition.height=34}if(strLineEndArrowDirection=="to_bottom"){ptTemp.x=objTargetNodeConnectAreaUIPosition.center_x;ptTemp.y=objTargetNodeConnectAreaUIPosition.center_y-objTargetNodeConnectAreaUIPosition.height/2}else{if(strLineEndArrowDirection=="to_left"){ptTemp.x=objTargetNodeConnectAreaUIPosition.center_x+objTargetNodeConnectAreaUIPosition.width/2;ptTemp.y=objTargetNodeConnectAreaUIPosition.center_y}else{ptTemp.x=objTargetNodeConnectAreaUIPosition.center_x-objTargetNodeConnectAreaUIPosition.width/2;ptTemp.y=objTargetNodeConnectAreaUIPosition.center_y}}return ptTemp};HXWebWorkflowEditor.WorkflowDefinitionUtility._FindAndRemoveWorkflowNodeTargetNodeCodeInfo=function(strTargetWorkflowNodeCode){var arrHXXmlNodes=[];var objTempHXXmlNode,objTempHXXmlNodeForUILine;var objTempHXXmlNodeList=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectNodes("//HXWORKFLOW_NODE[@TARGET_NODE_CODE='"+strTargetWorkflowNodeCode.toLowerCase()+"' or @TARGET_NODE_CODE='"+strTargetWorkflowNodeCode.toUpperCase()+"']");for(var i=0;i<objTempHXXmlNodeList.length;i++){objTempHXXmlNode=objTempHXXmlNodeList[i];objTempHXXmlNode.SetAttributeValue("TARGET_NODE_CODE","");objTempHXXmlNodeForUILine=objTempHXXmlNode.SelectSingleNode(".//UI_LINE");if(objTempHXXmlNodeForUILine!=null){objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_TARGET_TYPE","");objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_ARROW_DIRECTION","");objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_POSITION","")}arrHXXmlNodes.push(objTempHXXmlNode)}objTempHXXmlNodeList=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectNodes("//HXWORKFLOW_NODE[@TARGET_NODE_CODE__IF_TRUE='"+strTargetWorkflowNodeCode.toLowerCase()+"' or @TARGET_NODE_CODE__IF_TRUE='"+strTargetWorkflowNodeCode.toUpperCase()+"']");for(var i=0;i<objTempHXXmlNodeList.length;i++){objTempHXXmlNode=objTempHXXmlNodeList[i];objTempHXXmlNode.SetAttributeValue("TARGET_NODE_CODE__IF_TRUE","");objTempHXXmlNodeForUILine=objTempHXXmlNode.SelectSingleNode(".//UI_LINE[@LINE_TYPE='true']");if(objTempHXXmlNodeForUILine!=null){objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_TARGET_TYPE","");objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_ARROW_DIRECTION","");objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_POSITION","")}arrHXXmlNodes.push(objTempHXXmlNode)}objTempHXXmlNodeList=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectNodes("//HXWORKFLOW_NODE[@TARGET_NODE_CODE__IF_FALSE='"+strTargetWorkflowNodeCode.toLowerCase()+"' or @TARGET_NODE_CODE__IF_FALSE='"+strTargetWorkflowNodeCode.toUpperCase()+"']");for(var i=0;i<objTempHXXmlNodeList.length;i++){objTempHXXmlNode=objTempHXXmlNodeList[i];objTempHXXmlNode.SetAttributeValue("TARGET_NODE_CODE__IF_FALSE","");objTempHXXmlNodeForUILine=objTempHXXmlNode.SelectSingleNode(".//UI_LINE[@LINE_TYPE='false']");if(objTempHXXmlNodeForUILine!=null){objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_TARGET_TYPE","");objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_ARROW_DIRECTION","");objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_POSITION","")}arrHXXmlNodes.push(objTempHXXmlNode)}objTempHXXmlNodeList=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectNodes("//HXWORKFLOW_NODE[@TARGET_NODE_CODE__IF_ACCEPT='"+strTargetWorkflowNodeCode.toLowerCase()+"' or @TARGET_NODE_CODE__IF_ACCEPT='"+strTargetWorkflowNodeCode.toUpperCase()+"']");for(var i=0;i<objTempHXXmlNodeList.length;i++){objTempHXXmlNode=objTempHXXmlNodeList[i];objTempHXXmlNode.SetAttributeValue("TARGET_NODE_CODE__IF_ACCEPT","");objTempHXXmlNodeForUILine=objTempHXXmlNode.SelectSingleNode(".//UI_LINE[@LINE_TYPE='accept']");if(objTempHXXmlNodeForUILine!=null){objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_TARGET_TYPE","");objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_ARROW_DIRECTION","");objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_POSITION","")}arrHXXmlNodes.push(objTempHXXmlNode)}objTempHXXmlNodeList=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectNodes("//HXWORKFLOW_NODE[@TARGET_NODE_CODE__IF_DENY='"+strTargetWorkflowNodeCode.toLowerCase()+"' or @TARGET_NODE_CODE__IF_DENY='"+strTargetWorkflowNodeCode.toUpperCase()+"']");for(var i=0;i<objTempHXXmlNodeList.length;i++){objTempHXXmlNode=objTempHXXmlNodeList[i];objTempHXXmlNode.SetAttributeValue("TARGET_NODE_CODE__IF_DENY","");objTempHXXmlNodeForUILine=objTempHXXmlNode.SelectSingleNode(".//UI_LINE[@LINE_TYPE='deny']");if(objTempHXXmlNodeForUILine!=null){objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_TARGET_TYPE","");objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_ARROW_DIRECTION","");objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_POSITION","")}arrHXXmlNodes.push(objTempHXXmlNode)}var objHXXmlNodeListForBranch;objTempHXXmlNodeList=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectNodes("//HXWORKFLOW_NODE[@TYPE='WORKFLOW_BRANCH']");for(var i=0;i<objTempHXXmlNodeList.length;i++){objTempHXXmlNode=objTempHXXmlNodeList[i];objHXXmlNodeListForBranch=objTempHXXmlNode.SelectNodes("BRANCH[@TARGET_NODE_CODE='"+strTargetWorkflowNodeCode.toLowerCase()+"' or @TARGET_NODE_CODE='"+strTargetWorkflowNodeCode.toUpperCase()+"']");for(var j=0;j<objHXXmlNodeListForBranch.length;j++){objHXXmlNodeListForBranch[j].SetAttributeValue("TARGET_NODE_CODE","");objTempHXXmlNodeForUILine=objTempHXXmlNode.SelectSingleNode(".//UI_LINE[@LINE_TYPE='"+objHXXmlNodeListForBranch[j].GetAttributeValue("ID")+"']");if(objTempHXXmlNodeForUILine!=null){objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_TARGET_TYPE","");objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_ARROW_DIRECTION","");objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_POSITION","")}}if(objHXXmlNodeListForBranch.length>0){arrHXXmlNodes.push(objTempHXXmlNode)}}var objHXXmlNodeListForRoute;objTempHXXmlNodeList=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectNodes("//HXWORKFLOW_NODE[@TYPE='WORKFLOW_PARALLEL__BEGIN']");for(var i=0;i<objTempHXXmlNodeList.length;i++){objTempHXXmlNode=objTempHXXmlNodeList[i];objHXXmlNodeListForRoute=objTempHXXmlNode.SelectNodes("ROUTE_OUT[@TARGET_NODE_CODE='"+strTargetWorkflowNodeCode.toLowerCase()+"' or @TARGET_NODE_CODE='"+strTargetWorkflowNodeCode.toUpperCase()+"']");for(var j=0;j<objHXXmlNodeListForRoute.length;j++){objHXXmlNodeListForRoute[j].SetAttributeValue("TARGET_NODE_CODE","");objTempHXXmlNodeForUILine=objTempHXXmlNode.SelectSingleNode(".//UI_LINE[@LINE_TYPE='"+objHXXmlNodeListForRoute[j].GetAttributeValue("ID")+"']");if(objTempHXXmlNodeForUILine!=null){objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_TARGET_TYPE","");objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_ARROW_DIRECTION","");objTempHXXmlNodeForUILine.SetAttributeValue("LINE_END_POSITION","")}}if(objHXXmlNodeListForRoute.length>0){arrHXXmlNodes.push(objTempHXXmlNode)}}return arrHXXmlNodes};HXWebWorkflowEditor.WorkflowDefinitionUtility.AppendNewWorkflowRuleNode=function(ptLeftTopCorner){var objRootWorkflowHXXmlNode=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode();var strTemp=objRootWorkflowHXXmlNode.GetAttributeValue("USED_MAX_UI_CONTROL_NO");var intCurrentProcessedNodesCount=(strTemp==null||strTemp==""?0:parseInt(strTemp));HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode().SetAttributeValue("USED_MAX_UI_CONTROL_NO",intCurrentProcessedNodesCount+1,true);var intNextWorkflowNodeNumber=intCurrentProcessedNodesCount+1;var strWorkflowNodeCode="hxworkflow_rule_"+intNextWorkflowNodeNumber.toString();var sb_xml=new HXWebStringBuilder();sb_xml.append('<HXWORKFLOW_NODE TYPE="WORKFLOW_RULE"');sb_xml.append(' CODE="'+strWorkflowNodeCode+'"');sb_xml.append(' NODE_NAME="规则'+intNextWorkflowNodeNumber.toString()+'"');sb_xml.append(' NODE_NAME_OT="Rule'+intNextWorkflowNodeNumber.toString()+'"');sb_xml.append(' TARGET_NODE_CODE__IF_TRUE="" TARGET_NODE_CODE__IF_FALSE="">');sb_xml.append('<UI_DATA UI_NODE_CENTER_POINT="'+(ptLeftTopCorner.left+20)+","+((ptLeftTopCorner.top+17))+'"');sb_xml.append(' UI_NODE_SIZE="150,20">');sb_xml.append('<UI_LINE CODE="'+strWorkflowNodeCode+'__line_true" LINE_TYPE="true" />');sb_xml.append('<UI_LINE CODE="'+strWorkflowNodeCode+'__line_false" LINE_TYPE="false" />');sb_xml.append("</UI_DATA>");sb_xml.append("</HXWORKFLOW_NODE>");var objTempHXXmlDoc=HXWebJS.Xml.GetHXXmlDocumentViaXmlString(sb_xml.toString());objRootWorkflowHXXmlNode.AppendChild(objTempHXXmlDoc.SelectSingleNode("//HXWORKFLOW_NODE").CloneNode());return strWorkflowNodeCode};HXWebWorkflowEditor.WorkflowDefinitionUtility.AppendNewWorkflowBranchNode=function(ptLeftTopCorner){var objRootWorkflowHXXmlNode=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode();var strTemp=objRootWorkflowHXXmlNode.GetAttributeValue("USED_MAX_UI_CONTROL_NO");var intCurrentProcessedNodesCount=(strTemp==null||strTemp==""?0:parseInt(strTemp));HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode().SetAttributeValue("USED_MAX_UI_CONTROL_NO",intCurrentProcessedNodesCount+1,true);var intNextWorkflowNodeNumber=intCurrentProcessedNodesCount+1;var strWorkflowNodeCode="hxworkflow_branch_"+intNextWorkflowNodeNumber.toString();var sb_xml=new HXWebStringBuilder();sb_xml.append('<HXWORKFLOW_NODE TYPE="WORKFLOW_BRANCH"');sb_xml.append(' CODE="'+strWorkflowNodeCode+'"');sb_xml.append(' NODE_NAME="分支'+intNextWorkflowNodeNumber.toString()+'"');sb_xml.append(' NODE_NAME_OT="Branch'+intNextWorkflowNodeNumber.toString()+'"');sb_xml.append(' BRANCH_COUNT="3">');sb_xml.append('<BRANCH ID="1" TARGET_NODE_CODE="" /><BRANCH ID="2" TARGET_NODE_CODE="" /><BRANCH ID="3" TARGET_NODE_CODE="" />');sb_xml.append('<UI_DATA UI_NODE_CENTER_POINT="'+(ptLeftTopCorner.left+20)+","+((ptLeftTopCorner.top+17))+'"');sb_xml.append(' UI_NODE_SIZE="180,20">');sb_xml.append('<UI_LINE CODE="'+strWorkflowNodeCode+'__line_1" LINE_TYPE="1" />');sb_xml.append('<UI_LINE CODE="'+strWorkflowNodeCode+'__line_2" LINE_TYPE="2" />');sb_xml.append('<UI_LINE CODE="'+strWorkflowNodeCode+'__line_3" LINE_TYPE="3" />');sb_xml.append("</UI_DATA>");sb_xml.append("</HXWORKFLOW_NODE>");var objTempHXXmlDoc=HXWebJS.Xml.GetHXXmlDocumentViaXmlString(sb_xml.toString());objRootWorkflowHXXmlNode.AppendChild(objTempHXXmlDoc.SelectSingleNode("//HXWORKFLOW_NODE").CloneNode());return strWorkflowNodeCode};HXWebWorkflowEditor.WorkflowDefinitionUtility.AppendNewWorkflowEndNode=function(ptLeftTopCorner,blnIsAgree){var objRootWorkflowHXXmlNode=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode();var strTemp=objRootWorkflowHXXmlNode.GetAttributeValue("USED_MAX_UI_CONTROL_NO");var intCurrentProcessedNodesCount=(strTemp==null||strTemp==""?0:parseInt(strTemp));HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode().SetAttributeValue("USED_MAX_UI_CONTROL_NO",intCurrentProcessedNodesCount+1,true);var intNextWorkflowNodeNumber=intCurrentProcessedNodesCount+1;var strWorkflowNodeCode="hxworkflow_end_"+(blnIsAgree?"agree":"refuse")+"_"+intNextWorkflowNodeNumber.toString();var sb_xml=new HXWebStringBuilder();sb_xml.append('<HXWORKFLOW_NODE TYPE="WORKFLOW_END__'+(blnIsAgree?"AGREE":"REFUSE")+'"');sb_xml.append(' CODE="'+strWorkflowNodeCode+'">');sb_xml.append('<UI_DATA UI_NODE_CENTER_POINT="'+(ptLeftTopCorner.left+15)+","+((ptLeftTopCorner.top+15))+'"');sb_xml.append(' UI_NODE_SIZE="30,30">');sb_xml.append("</UI_DATA>");sb_xml.append("</HXWORKFLOW_NODE>");var objTempHXXmlDoc=HXWebJS.Xml.GetHXXmlDocumentViaXmlString(sb_xml.toString());objRootWorkflowHXXmlNode.AppendChild(objTempHXXmlDoc.SelectSingleNode("//HXWORKFLOW_NODE").CloneNode());return strWorkflowNodeCode};HXWebWorkflowEditor.WorkflowDefinitionUtility.AppendNewWorkflowActivityNode=function(ptLeftTopCorner,strActivityType,blnIsAutoTask){if(strActivityType==null||strActivityType==""){return null}var objRootWorkflowHXXmlNode=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode();var strTemp=objRootWorkflowHXXmlNode.GetAttributeValue("USED_MAX_UI_CONTROL_NO");var intCurrentProcessedNodesCount=(strTemp==null||strTemp==""?0:parseInt(strTemp));HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode().SetAttributeValue("USED_MAX_UI_CONTROL_NO",intCurrentProcessedNodesCount+1,true);var intNextWorkflowNodeNumber=intCurrentProcessedNodesCount+1;var strWorkflowNodeCode="hxworkflow_activity_"+strActivityType.toLowerCase()+"_"+intNextWorkflowNodeNumber.toString();var sb_xml=new HXWebStringBuilder();sb_xml.append('<HXWORKFLOW_NODE TYPE="WORKFLOW_ACTIVITY"');sb_xml.append(' ACTIVITY_TYPE="'+strActivityType.toUpperCase()+'"');sb_xml.append(' CODE="'+strWorkflowNodeCode+'"');sb_xml.append(' IS_AUTO_TASK="'+(blnIsAutoTask?"1":"0")+'"');sb_xml.append(' NODE_NAME="活动'+intNextWorkflowNodeNumber.toString()+'"');sb_xml.append(' NODE_NAME_OT="Activity '+intNextWorkflowNodeNumber.toString()+'"');var intDefaultProcessMethodIfDeny=(blnIsAutoTask?-1:0);sb_xml.append(' TARGET_NODE_CODE__IF_ACCEPT="" TARGET_NODE_CODE__IF_DENY="" PROCESS_METHOD__IF_DENY="'+intDefaultProcessMethodIfDeny+'" >');sb_xml.append('<UI_DATA UI_NODE_CENTER_POINT="'+(ptLeftTopCorner.left+80)+","+((ptLeftTopCorner.top+20))+'"');sb_xml.append(' UI_NODE_SIZE="160,40">');sb_xml.append('<UI_LINE CODE="'+strWorkflowNodeCode+'__line_accept" LINE_TYPE="accept" />');if(intDefaultProcessMethodIfDeny==0){sb_xml.append('<UI_LINE CODE="'+strWorkflowNodeCode+'__line_deny" LINE_TYPE="deny" />')}sb_xml.append("</UI_DATA>");sb_xml.append("</HXWORKFLOW_NODE>");var objTempHXXmlDoc=HXWebJS.Xml.GetHXXmlDocumentViaXmlString(sb_xml.toString());objRootWorkflowHXXmlNode.AppendChild(objTempHXXmlDoc.SelectSingleNode("//HXWORKFLOW_NODE").CloneNode());return strWorkflowNodeCode};HXWebWorkflowEditor.WorkflowDefinitionUtility.AppendNewWorkflowParallelBeginNode=function(ptLeftTopCorner){var objRootWorkflowHXXmlNode=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode();var strTemp=objRootWorkflowHXXmlNode.GetAttributeValue("USED_MAX_UI_CONTROL_NO");var intCurrentProcessedNodesCount=(strTemp==null||strTemp==""?0:parseInt(strTemp));HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode().SetAttributeValue("USED_MAX_UI_CONTROL_NO",intCurrentProcessedNodesCount+1,true);var intNextWorkflowNodeNumber=intCurrentProcessedNodesCount+1;var strWorkflowNodeCode="hxworkflow_parallel_begin_"+intNextWorkflowNodeNumber.toString();var sb_xml=new HXWebStringBuilder();sb_xml.append('<HXWORKFLOW_NODE TYPE="WORKFLOW_PARALLEL__BEGIN"');sb_xml.append(' CODE="'+strWorkflowNodeCode+'"');sb_xml.append(' ROUTE_COUNT="2">');sb_xml.append('<ROUTE_OUT ID="1" TARGET_NODE_CODE="" /><ROUTE_OUT ID="2" TARGET_NODE_CODE="" />');sb_xml.append('<UI_DATA UI_NODE_CENTER_POINT="'+(ptLeftTopCorner.left+80)+","+((ptLeftTopCorner.top+4))+'"');sb_xml.append(' UI_NODE_SIZE="160,8">');sb_xml.append('<UI_LINE CODE="'+strWorkflowNodeCode+'__line_1" LINE_TYPE="1" />');sb_xml.append('<UI_LINE CODE="'+strWorkflowNodeCode+'__line_2" LINE_TYPE="2" />');sb_xml.append("</UI_DATA>");sb_xml.append("</HXWORKFLOW_NODE>");var objTempHXXmlDoc=HXWebJS.Xml.GetHXXmlDocumentViaXmlString(sb_xml.toString());objRootWorkflowHXXmlNode.AppendChild(objTempHXXmlDoc.SelectSingleNode("//HXWORKFLOW_NODE").CloneNode());return strWorkflowNodeCode};HXWebWorkflowEditor.WorkflowDefinitionUtility.AppendNewWorkflowParallelEndNode=function(ptLeftTopCorner){var objRootWorkflowHXXmlNode=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode();var strTemp=objRootWorkflowHXXmlNode.GetAttributeValue("USED_MAX_UI_CONTROL_NO");var intCurrentProcessedNodesCount=(strTemp==null||strTemp==""?0:parseInt(strTemp));HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode().SetAttributeValue("USED_MAX_UI_CONTROL_NO",intCurrentProcessedNodesCount+1,true);var intNextWorkflowNodeNumber=intCurrentProcessedNodesCount+1;var strWorkflowNodeCode="hxworkflow_parallel_end_"+intNextWorkflowNodeNumber.toString();var sb_xml=new HXWebStringBuilder();sb_xml.append('<HXWORKFLOW_NODE TYPE="WORKFLOW_PARALLEL__END"');sb_xml.append(' CODE="'+strWorkflowNodeCode+'"');sb_xml.append(' ROUTE_COUNT="2" TARGET_NODE_CODE="" >');sb_xml.append('<UI_DATA UI_NODE_CENTER_POINT="'+(ptLeftTopCorner.left+80)+","+((ptLeftTopCorner.top+4))+'"');sb_xml.append(' UI_NODE_SIZE="160,8">');sb_xml.append('<UI_LINE CODE="'+strWorkflowNodeCode+'__line" />');sb_xml.append("</UI_DATA>");sb_xml.append("</HXWORKFLOW_NODE>");var objTempHXXmlDoc=HXWebJS.Xml.GetHXXmlDocumentViaXmlString(sb_xml.toString());objRootWorkflowHXXmlNode.AppendChild(objTempHXXmlDoc.SelectSingleNode("//HXWORKFLOW_NODE").CloneNode());return strWorkflowNodeCode};HXWebWorkflowEditor.WorkflowDefinitionUtility.AppendNewWorkflowConnectPoint=function(ptLeftTopCorner){var objRootWorkflowHXXmlNode=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode();var strTemp=objRootWorkflowHXXmlNode.GetAttributeValue("USED_MAX_UI_CONTROL_NO");var intCurrentProcessedNodesCount=(strTemp==null||strTemp==""?0:parseInt(strTemp));HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.GetRootXmlNode().SetAttributeValue("USED_MAX_UI_CONTROL_NO",intCurrentProcessedNodesCount+2,true);var intNextWorkflowNodeNumber=intCurrentProcessedNodesCount+1;var strWorkflowNodeCodeIn="hxworkflow_connectpoint_in_"+intNextWorkflowNodeNumber.toString();var strWorkflowNodeCodeOut="hxworkflow_connectpoint_out_"+(intNextWorkflowNodeNumber+1).toString();var intNewConnectPointNo=1;for(intNewConnectPointNo=1;intNewConnectPointNo<100;intNewConnectPointNo++){if(HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectSingleNode("//HXWORKFLOW_NODE[@CONNECT_POINT_NO='"+intNewConnectPointNo+"']")==null){break}}if(intNewConnectPointNo>=100){alert("工作流程中使用的连接点数量不允许超过100个！");return null}var sb_xml=new HXWebStringBuilder();sb_xml.append('<HXWORKFLOW_NODE TYPE="WORKFLOW_CONNECT_POINT_IN"');sb_xml.append(' CODE="'+strWorkflowNodeCodeIn+'"');sb_xml.append(' CONNECT_POINT_NO="'+intNewConnectPointNo+'" >');sb_xml.append('<UI_DATA UI_NODE_CENTER_POINT="'+(ptLeftTopCorner.left+10)+","+((ptLeftTopCorner.top+10))+'"');sb_xml.append(' UI_NODE_SIZE="20,20">');sb_xml.append("</UI_DATA>");sb_xml.append("</HXWORKFLOW_NODE>");var objTempHXXmlDoc=HXWebJS.Xml.GetHXXmlDocumentViaXmlString(sb_xml.toString());objRootWorkflowHXXmlNode.AppendChild(objTempHXXmlDoc.SelectSingleNode("//HXWORKFLOW_NODE").CloneNode());sb_xml.clear();sb_xml.append('<HXWORKFLOW_NODE TYPE="WORKFLOW_CONNECT_POINT_OUT" TARGET_NODE_CODE=""');sb_xml.append(' CODE="'+strWorkflowNodeCodeOut+'"');sb_xml.append(' CONNECT_POINT_NO="'+intNewConnectPointNo+'" >');sb_xml.append('<UI_DATA UI_NODE_CENTER_POINT="'+(ptLeftTopCorner.left+50)+","+((ptLeftTopCorner.top+10))+'"');sb_xml.append(' UI_NODE_SIZE="20,20">');sb_xml.append('<UI_LINE CODE="'+strWorkflowNodeCodeOut+'__line" />');sb_xml.append("</UI_DATA>");sb_xml.append("</HXWORKFLOW_NODE>");objTempHXXmlDoc=HXWebJS.Xml.GetHXXmlDocumentViaXmlString(sb_xml.toString());objRootWorkflowHXXmlNode.AppendChild(objTempHXXmlDoc.SelectSingleNode("//HXWORKFLOW_NODE").CloneNode());return strWorkflowNodeCodeIn+";"+strWorkflowNodeCodeOut};HXWebWorkflowEditor.HXWorkflowConnectionLine={};HXWebWorkflowEditor.HXWorkflowConnectionLine._GetLineColor=function(strLineColorName){if(strLineColorName=="green"){return"#63ac1f"}if(strLineColorName=="blue"){return"#0000ff"}if(strLineColorName=="orange"){return"#ff8000"}return"#808080"};HXWebWorkflowEditor.HXWorkflowConnectionLine._DrawLinePiece=function(strLinePieceHtmlId,strLinePieceColor,settings){var editorDIVContainer=HXWebWorkflowEditor._Internal._EditorDivContainerHtmlElement;var strWorkflowNodeCode=settings.workflow_node_code;var _line=document.getElementById(strLinePieceHtmlId);var sb_html=new HXWebStringBuilder();if(_line==null){sb_html.append("<img");sb_html.append(' id="'+strLinePieceHtmlId+'"');sb_html.append(' src="../hximages_v6/hxpub_clear.gif"');sb_html.append(" hx_workflow_node_code="+strWorkflowNodeCode);sb_html.append(' style="position:absolute;z-index:1001;"');sb_html.append(" />");_line=jQuery(sb_html.toString())[0];editorDIVContainer.appendChild(_line);_line.style.backgroundColor=strLinePieceColor}if(settings.width<0){settings.width*=-1;settings.left-=settings.width}if(settings.height<0){settings.height*=-1;settings.top-=settings.height}_line.style.left=settings.left+"px";_line.style.top=settings.top+"px";_line.style.width=settings.width+"px";_line.style.height=settings.height+"px"};HXWebWorkflowEditor.HXWorkflowConnectionLine._DrawOrMove=function(strWorkflowNodeType,strWorkflowNodeCode,strLineCode,settings){var LINE_BEGIN_END_FIXED_SEG_LENGTH=10;var ARROW_BLOCK_LENGTH=10;if(settings.end_x==null){settings.end_x=settings.begin_x;settings.end_y=settings.begin_y+LINE_BEGIN_END_FIXED_SEG_LENGTH*3}if(settings.line_end_arrow_direction==null){settings.line_end_arrow_direction="to_bottom"}if(settings.line_color==null){settings.line_color="black"}var ptBeginSegmentTo={x:settings.begin_x,y:settings.begin_y+LINE_BEGIN_END_FIXED_SEG_LENGTH};var ptEndSegmentFrom={x:0,y:0};var ptEndSegmentTo={x:0,y:0};var ptArrowBlockLeftTop={x:0,y:0};if(settings.line_end_arrow_direction=="to_bottom"){ptEndSegmentTo.x=settings.end_x;ptEndSegmentTo.y=settings.end_y-ARROW_BLOCK_LENGTH;ptArrowBlockLeftTop.x=ptEndSegmentTo.x-ARROW_BLOCK_LENGTH/2+1;ptArrowBlockLeftTop.y=ptEndSegmentTo.y;ptEndSegmentFrom.x=settings.end_x;ptEndSegmentFrom.y=ptEndSegmentTo.y-LINE_BEGIN_END_FIXED_SEG_LENGTH}else{if(settings.line_end_arrow_direction=="to_left"){ptEndSegmentTo.x=settings.end_x+ARROW_BLOCK_LENGTH;ptEndSegmentTo.y=settings.end_y;ptArrowBlockLeftTop.x=settings.end_x;ptArrowBlockLeftTop.y=settings.end_y-ARROW_BLOCK_LENGTH/2+1;ptEndSegmentFrom.x=settings.end_x+LINE_BEGIN_END_FIXED_SEG_LENGTH;ptEndSegmentFrom.y=ptEndSegmentTo.y}else{if(settings.line_end_arrow_direction=="to_right"){ptEndSegmentTo.x=settings.end_x-ARROW_BLOCK_LENGTH;ptEndSegmentTo.y=settings.end_y;ptArrowBlockLeftTop.x=ptEndSegmentTo.x;ptArrowBlockLeftTop.y=settings.end_y-ARROW_BLOCK_LENGTH/2+1;ptEndSegmentFrom.x=settings.end_x-LINE_BEGIN_END_FIXED_SEG_LENGTH;ptEndSegmentFrom.y=ptEndSegmentTo.y}}}var ptConnectionSegment_M1={x:parseInt((ptBeginSegmentTo.x+ptEndSegmentFrom.x+0.5)/2),y:ptBeginSegmentTo.y};var ptConnectionSegment_M2={x:parseInt((ptBeginSegmentTo.x+ptEndSegmentFrom.x+0.5)/2),y:ptEndSegmentFrom.y};strLineCode=strLineCode.toLowerCase();var strLineArrowImgElementId=strLineCode+"__line_arrow_img";var strLineEndArrowImgFileName="line_arrow_"+settings.line_end_arrow_direction+"_"+settings.line_color+".png";var _img=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strLineArrowImgElementId,strLineEndArrowImgFileName,1001,{workflow_node_type:strWorkflowNodeType,workflow_html_element_type:"line_arrow_img",workflow_node_code:strWorkflowNodeCode});_img.style.left=ptArrowBlockLeftTop.x.toString()+"px";_img.style.top=ptArrowBlockLeftTop.y.toString()+"px";_img.src="../hximages_v6/hxworkflow/"+strLineEndArrowImgFileName;var strLinePieceColor=HXWebWorkflowEditor.HXWorkflowConnectionLine._GetLineColor(settings.line_color);HXWebWorkflowEditor.HXWorkflowConnectionLine._DrawLinePiece(strLineCode+"__line_piece_first",strLinePieceColor,{workflow_node_code:strWorkflowNodeCode,left:settings.begin_x,top:settings.begin_y,width:2,height:ptBeginSegmentTo.y-settings.begin_y+2});var intTempAdjust=(ptConnectionSegment_M1.x>ptBeginSegmentTo.x?2:0);HXWebWorkflowEditor.HXWorkflowConnectionLine._DrawLinePiece(strLineCode+"__line_piece_m0",strLinePieceColor,{workflow_node_code:strWorkflowNodeCode,left:ptBeginSegmentTo.x,top:ptBeginSegmentTo.y,width:ptConnectionSegment_M1.x-ptBeginSegmentTo.x+intTempAdjust,height:2});intTempAdjust=(ptConnectionSegment_M2.y>ptConnectionSegment_M1.y?2:0);HXWebWorkflowEditor.HXWorkflowConnectionLine._DrawLinePiece(strLineCode+"__line_piece_m1",strLinePieceColor,{workflow_node_code:strWorkflowNodeCode,left:ptConnectionSegment_M1.x,top:ptConnectionSegment_M1.y,width:2,height:ptConnectionSegment_M2.y-ptConnectionSegment_M1.y+intTempAdjust});intTempAdjust=(ptEndSegmentFrom.x>ptConnectionSegment_M2.x?2:0);HXWebWorkflowEditor.HXWorkflowConnectionLine._DrawLinePiece(strLineCode+"__line_piece_m2",strLinePieceColor,{workflow_node_code:strWorkflowNodeCode,left:ptConnectionSegment_M2.x,top:ptConnectionSegment_M2.y,width:ptEndSegmentFrom.x-ptConnectionSegment_M2.x+intTempAdjust,height:2});if(settings.line_end_arrow_direction=="to_bottom"){HXWebWorkflowEditor.HXWorkflowConnectionLine._DrawLinePiece(strLineCode+"__line_piece_last",strLinePieceColor,{workflow_node_code:strWorkflowNodeCode,left:ptEndSegmentFrom.x,top:ptEndSegmentFrom.y,width:2,height:ptEndSegmentTo.y-ptEndSegmentFrom.y})}else{HXWebWorkflowEditor.HXWorkflowConnectionLine._DrawLinePiece(strLineCode+"__line_piece_last",strLinePieceColor,{workflow_node_code:strWorkflowNodeCode,left:ptEndSegmentFrom.x,top:ptEndSegmentFrom.y,width:Math.abs(ptEndSegmentTo.x-ptEndSegmentFrom.x),height:2})}};HXWebWorkflowEditor.HXWorkflowConnectionLine.DrawLineViaWorkflowDefinition=function(strWorkflowNodeType,strWorkflowNodeCode,objHXXmlNodeForWorkflowNode,objHXXmlNode_UILine,objNodeUIPosition){var strLineCode=objHXXmlNode_UILine.GetAttributeValue("CODE");if(strLineCode==null||strLineCode==""){strLineCode="hxworkflowstart__line"}else{strLineCode=strLineCode.toLowerCase()}var objLineDrawInfo=HXWebWorkflowEditor.WorkflowDefinitionUtility._CalculateAndGetUILinePointAndColorInfo(strWorkflowNodeType,objHXXmlNodeForWorkflowNode,objNodeUIPosition,objHXXmlNode_UILine,strLineCode);HXWebWorkflowEditor.HXWorkflowConnectionLine._DrawOrMove(strWorkflowNodeType,strWorkflowNodeCode,strLineCode,objLineDrawInfo)};HXWebWorkflowEditor.HXWorkflowConnectionLine._RemoveLine=function(strUILineCode){jQuery("img#"+strUILineCode+"__line_arrow_img").remove();jQuery("img#"+strUILineCode+"__line_arrow_chosen_img").remove();jQuery("img#"+strUILineCode+"__line_piece_first").remove();jQuery("img#"+strUILineCode+"__line_piece_m0").remove();jQuery("img#"+strUILineCode+"__line_piece_m1").remove();jQuery("img#"+strUILineCode+"__line_piece_m2").remove();jQuery("img#"+strUILineCode+"__line_piece_last").remove()};HXWebWorkflowEditor.HXWorkflowConnectionLine.MarkLineEndArrowAsDraggable=function(strWorkflowNodeCode,objHXXmlNode_UILine){var strWorkflowNodeType=objHXXmlNode_UILine.SelectSingleNode("../../@TYPE").GetText();var strLineEndArrowDirection=objHXXmlNode_UILine.GetAttributeValue("LINE_END_ARROW_DIRECTION");if(strLineEndArrowDirection==null||strLineEndArrowDirection==""){strLineEndArrowDirection="to_bottom"}var strLineType=objHXXmlNode_UILine.GetAttributeValue("LINE_TYPE");if(strLineType==null){strLineType=""}var strLineCode=objHXXmlNode_UILine.GetAttributeValue("CODE");if(strLineCode==null||strLineCode==""){strLineCode="hxworkflowstart__line"}else{strLineCode=strLineCode.toLowerCase()}var imgLineEndArrowHtmlElement=document.getElementById(strLineCode+"__line_arrow_img");if(imgLineEndArrowHtmlElement==null){return}var strImgFileNameOnly="line_arrow_"+strLineEndArrowDirection+"_chosen.png";var _imgTemp=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strLineCode+"__line_arrow_chosen_img",strImgFileNameOnly,1003,{workflow_node_type:strWorkflowNodeType,workflow_node_code:strWorkflowNodeCode,workflow_line_type:strLineType,workflow_line_code:strLineCode,workflow_html_element_type:"line_arrow_chosen_img"});_imgTemp.className="hx_workflow_arrow_chosen";_imgTemp.style.display="";_imgTemp.style.left=imgLineEndArrowHtmlElement.style.left;_imgTemp.style.top=imgLineEndArrowHtmlElement.style.top;_imgTemp.src="../hximages_v6/hxworkflow/"+strImgFileNameOnly;jQuery(_imgTemp).draggable({drag:HXWebWorkflowEditor._DragDropProcess._OnLineEndArrowDragOver,stop:HXWebWorkflowEditor._DragDropProcess._OnLineEndArrowDragStopped});jQuery(_imgTemp).draggable()};HXWebWorkflowEditor._DragDropProcess={};HXWebWorkflowEditor._DragDropProcess.MarkWorkflowNodeAsDraggable=function(strWorkflowNodeCode,blnIsChosen){if(strWorkflowNodeCode==null||strWorkflowNodeCode==""){strWorkflowNodeCode="hxworkflowstart"}var objHXXmlNodeForWorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strWorkflowNodeCode);if(objHXXmlNodeForWorkflowNode==null){return}var strWorkflowNodeType=objHXXmlNodeForWorkflowNode.GetAttributeValue("TYPE");var strTemp=objHXXmlNodeForWorkflowNode.GetAttributeValue("NODE_PROCESS_STATUS");var intNodeProcessStatus=(strTemp==null||strTemp==""?0:parseInt(strTemp));var objHXXmlNodeList_UILines=objHXXmlNodeForWorkflowNode.SelectNodes(".//UI_DATA/UI_LINE");if(!blnIsChosen){HXWebWorkflowEditor._DragDropProcess._HideNodeDraggableHtmlElement(strWorkflowNodeType,strWorkflowNodeCode);_imgTemp=document.getElementById(strWorkflowNodeCode+"__img_config_btn");if(_imgTemp!=null){_imgTemp.style.display="none"}_imgTemp=document.getElementById(strWorkflowNodeCode+"__img_remove_btn");if(_imgTemp!=null){_imgTemp.style.display="none"}_imgTemp=document.getElementById(strWorkflowNodeCode+"__img_resize_btn");if(_imgTemp!=null){_imgTemp.style.display="none"}_imgTemp=document.getElementById(strWorkflowNodeCode+"__img_size_change_left_btn");if(_imgTemp!=null){_imgTemp.style.display="none"}_imgTemp=document.getElementById(strWorkflowNodeCode+"__img_size_change_right_btn");if(_imgTemp!=null){_imgTemp.style.display="none"}for(var i=0;i<objHXXmlNodeList_UILines.length;i++){strLineCode=objHXXmlNodeList_UILines[i].GetAttributeValue("CODE");_imgTemp=document.getElementById(strLineCode+"__line_arrow_chosen_img");if(_imgTemp!=null){_imgTemp.style.display="none"}}return}HXWebWorkflowEditor._DragDropProcess.RemovePrevisousChosenDraggableNode();HXWebWorkflowEditor._Internal._CurrentChosenWorkflowNodeCode=strWorkflowNodeCode;HXWebWorkflowEditor._Internal._CurrentChosenWorkflowNodeType=strWorkflowNodeType;var objNodeUIPosition=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetWorkflowNodeUIData(objHXXmlNodeForWorkflowNode);var objNodeChosenHtmlElement=HXWebWorkflowEditor._DragDropProcess._CreateNodeDraggableHtmlElement(strWorkflowNodeType,strWorkflowNodeCode,objNodeUIPosition);objNodeChosenHtmlElement.style.display="";jQuery(objNodeChosenHtmlElement).draggable({stop:HXWebWorkflowEditor._DragDropProcess._OnNodeChosenElementDragStopped});jQuery(objNodeChosenHtmlElement).draggable();if(intNodeProcessStatus==0){HXWebWorkflowEditor._DragDropProcess._CreateWorkflowNodeConfigAndRemoveHtmlButton(strWorkflowNodeType,strWorkflowNodeCode,objNodeUIPosition)}if(intNodeProcessStatus>=2){return}for(var i=0;i<objHXXmlNodeList_UILines.length;i++){HXWebWorkflowEditor.HXWorkflowConnectionLine.MarkLineEndArrowAsDraggable(strWorkflowNodeCode,objHXXmlNodeList_UILines[i])}};HXWebWorkflowEditor._DragDropProcess.RemovePrevisousChosenDraggableNode=function(){if(HXWebWorkflowEditor._Internal._CurrentChosenWorkflowNodeType==null){return}var strCurrentChosenWorkflowNodeCode=HXWebWorkflowEditor._Internal._CurrentChosenWorkflowNodeCode;if(strCurrentChosenWorkflowNodeCode==null||strCurrentChosenWorkflowNodeCode==""){return}HXWebWorkflowEditor._DragDropProcess.MarkWorkflowNodeAsDraggable(strCurrentChosenWorkflowNodeCode,false);HXWebWorkflowEditor._Internal._CurrentChosenWorkflowNodeCode="";HXWebWorkflowEditor._Internal._CurrentChosenWorkflowNodeType=""};HXWebWorkflowEditor._DragDropProcess._CreateNodeDraggableHtmlElement=function(strWorkflowNodeType,strWorkflowNodeCode,objNodeUIPosition){var _imgTemp;if(strWorkflowNodeCode==null||strWorkflowNodeCode==""){strWorkflowNodeCode="hxworkflowstart"}if(strWorkflowNodeType!="WORKFLOW_ACTIVITY"&&strWorkflowNodeType!="WORKFLOW_CONNECT_POINT_IN"&&strWorkflowNodeType!="WORKFLOW_CONNECT_POINT_OUT"){var strImgIconFileName="";switch(strWorkflowNodeType){case"WORKFLOW_START":strImgIconFileName="hxworkflowstart_chosen_frame.png";break;case"WORKFLOW_END__AGREE":strImgIconFileName="hxworkflowendagree_chosen_frame.png";break;case"WORKFLOW_END__REFUSE":strImgIconFileName="hxworkflowendrefuse_chosen_frame.png";break;case"WORKFLOW_RULE":strImgIconFileName="hxworkflowrule_chosen_frame.png";break;case"WORKFLOW_BRANCH":strImgIconFileName="hxworkflowbranch_chosen_frame.png";break;case"WORKFLOW_PARALLEL__BEGIN":strImgIconFileName="hxworkflowparallelbegin_chosen_frame.png";break;case"WORKFLOW_PARALLEL__END":strImgIconFileName="hxworkflowparallelend_chosen_frame.png";break}_imgTemp=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strWorkflowNodeCode+"__img_chosen_frame",strImgIconFileName,1003,{workflow_node_code:strWorkflowNodeCode,workflow_node_type:strWorkflowNodeType,workflow_html_element_type:"node_main_chosen_frame"});if(strWorkflowNodeType=="WORKFLOW_PARALLEL__BEGIN"||strWorkflowNodeType=="WORKFLOW_PARALLEL__END"){_imgTemp.style.left=(objNodeUIPosition.center_x-objNodeUIPosition.width/2)+"px";_imgTemp.style.top=(objNodeUIPosition.center_y-objNodeUIPosition.height/2)+"px";_imgTemp.style.width=objNodeUIPosition.width+"px";_imgTemp.style.height=objNodeUIPosition.height+"px";return _imgTemp}if(strWorkflowNodeType=="WORKFLOW_RULE"||strWorkflowNodeType=="WORKFLOW_BRANCH"){_imgTemp.style.left=(objNodeUIPosition.center_x-20)+"px";_imgTemp.style.top=(objNodeUIPosition.center_y-17)+"px";return _imgTemp}if(strWorkflowNodeType=="WORKFLOW_START"||strWorkflowNodeType=="WORKFLOW_END__AGREE"||strWorkflowNodeType=="WORKFLOW_END__REFUSE"){_imgTemp.style.left=(objNodeUIPosition.center_x-15)+"px";_imgTemp.style.top=(objNodeUIPosition.center_y-15)+"px";return _imgTemp}}if(strWorkflowNodeType=="WORKFLOW_ACTIVITY"){return HXWebWorkflowEditor._DragDropProcess._CreateActivityDraggableHtmlElement(strWorkflowNodeCode,objNodeUIPosition)}if(strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"||strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_OUT"){return HXWebWorkflowEditor._DragDropProcess._CreateConnectPointDraggableHtmlElement(strWorkflowNodeCode,objNodeUIPosition,strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN")}return null};HXWebWorkflowEditor._DragDropProcess._HideNodeDraggableHtmlElement=function(strWorkflowNodeType,strWorkflowNodeCode){if(strWorkflowNodeType!="WORKFLOW_ACTIVITY"&&strWorkflowNodeType!="WORKFLOW_CONNECT_POINT_IN"&&strWorkflowNodeType!="WORKFLOW_CONNECT_POINT_OUT"){var _imgTemp=document.getElementById(strWorkflowNodeCode+"__img_chosen_frame");if(_imgTemp!=null){_imgTemp.style.display="none"}return}if(strWorkflowNodeType=="WORKFLOW_ACTIVITY"){var _tempElement=document.getElementById(strWorkflowNodeCode+"__activity_draggable_div_area");if(_tempElement!=null){_tempElement.style.display="none"}}if(strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"||strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_OUT"){var _tempElement=document.getElementById(strWorkflowNodeCode+"__draggable_connect_point_container");if(_tempElement!=null){_tempElement.style.display="none"}}};HXWebWorkflowEditor._DragDropProcess._CreateActivityDraggableHtmlElement=function(strWorkflowNodeCode,objNodeUIPosition){var editorDIVContainer=HXWebWorkflowEditor._Internal._EditorDivContainerHtmlElement;var strDivHtmlId=strWorkflowNodeCode+"__activity_draggable_div_area";var objHXXmlNodeForWorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strWorkflowNodeCode);var strActivityDesc=objHXXmlNodeForWorkflowNode.GetAttributeValue("NODE_NAME"+(HXWebWorkflowEditor._Internal._options.db_language_type==1?"_OT":""));var strActivityType=objHXXmlNodeForWorkflowNode.GetAttributeValue("ACTIVITY_TYPE");var strTemp=objHXXmlNodeForWorkflowNode.GetAttributeValue("PROCESS_METHOD__IF_DENY");var intActivityOutletsCount=(strTemp=="-1"?0:2);strTemp=objHXXmlNodeForWorkflowNode.GetAttributeValue("NODE_PROCESS_STATUS");var intNodeProcessStatus=(strTemp==null||strTemp==""?0:parseInt(strTemp));var sb_html=new HXWebStringBuilder();var _divContainer=document.getElementById(strDivHtmlId);if(_divContainer==null){sb_html.append("<div");sb_html.append(' id="'+strDivHtmlId+'"');sb_html.append(" hx_workflow_node_type=workflow_activity");sb_html.append(" hx_workflow_node_code="+strWorkflowNodeCode);sb_html.append(" hx_workflow_html_element_type=hxworkflowactivity_draggable_div_area");sb_html.append(' style="position:absolute;z-index:1100;border:1px solid red;height:40px;background-color:white;border-radius:5px;"');sb_html.append("</div>");_divContainer=jQuery(sb_html.toString())[0];editorDIVContainer.appendChild(_divContainer);if(intNodeProcessStatus==1){_divContainer.style.backgroundColor="yellow"}else{if(intNodeProcessStatus==2){_divContainer.style.backgroundColor="#b4e61d"}}sb_html.clear();sb_html.append("<img id="+strWorkflowNodeCode+"__draggable_img_icon");sb_html.append(" hx_workflow_node_code="+strWorkflowNodeCode);sb_html.append(' style="position:absolute;z-index:1005;left:5px;top:5px;"');sb_html.append(' src="../hximages_v6/hxworkflow/hxworflowactivity_icon__'+strActivityType.toLowerCase()+'.png" />');var _imgPicture=jQuery(sb_html.toString())[0];_divContainer.appendChild(_imgPicture);sb_html.clear();sb_html.append("<div id="+strWorkflowNodeCode+"__draggable_text_desc_area");sb_html.append(" hx_workflow_node_code="+strWorkflowNodeCode);sb_html.append(' style="position:absolute;z-index:1005;left:40px;top:'+(intActivityOutletsCount==0?"10":"8")+'px;right:10px;border:none;line-height:20px;height:20px;"');sb_html.append("></div>");var _divTextArea=jQuery(sb_html.toString())[0];jQuery(_divTextArea).text(strActivityDesc);_divContainer.appendChild(_divTextArea)}jQuery("div#"+strWorkflowNodeCode+"__draggable_text_desc_area",_divContainer).text(strActivityDesc);_divContainer.style.width=objNodeUIPosition.width+"px";_divContainer.style.left=(objNodeUIPosition.center_x-objNodeUIPosition.width/2)+"px";_divContainer.style.top=(objNodeUIPosition.center_y-objNodeUIPosition.height/2)+"px";return _divContainer};HXWebWorkflowEditor._DragDropProcess._CreateConnectPointDraggableHtmlElement=function(strWorkflowNodeCode,objNodeUIPosition,blnIsConnectPointIn){var editorDIVContainer=HXWebWorkflowEditor._Internal._EditorDivContainerHtmlElement;var objHXXmlNodeForWorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strWorkflowNodeCode);var strConnectPointNo=objHXXmlNodeForWorkflowNode.GetAttributeValue("CONNECT_POINT_NO");var strDivHtmlId=strWorkflowNodeCode+"__draggable_connect_point_container";var _divContainer=document.getElementById(strDivHtmlId);var sb_html=new HXWebStringBuilder();if(_divContainer==null){sb_html.append('<div id="'+strDivHtmlId+'"');sb_html.append(" hx_workflow_node_type=workflow_connect_point_"+(blnIsConnectPointIn?"in":"out"));sb_html.append(" hx_workflow_node_code="+strWorkflowNodeCode);sb_html.append(' style="position:absolute;z-index:1001;width:24px;height:24px;"');sb_html.append("></div>");_divContainer=jQuery(sb_html.toString())[0];HXWebWorkflowEditor._Internal._EditorDivContainerHtmlElement.appendChild(_divContainer);var _imgCircle=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strWorkflowNodeCode+"__draggable_connect_point_circle_img","connect_point_chosen_frame.png",1002);_imgCircle.style.left="0px";_imgCircle.style.top="0px";_divContainer.appendChild(_imgCircle);var strTextAreaHtmlId=strWorkflowNodeCode+"__draggable_connect_point_textarea";sb_html.clear();sb_html.append('<div id="'+strTextAreaHtmlId+'"');sb_html.append(' style="position:absolute;z-index:1002;text-align:center;color:red;font-size:12px;left:3px;top:3px;width:16px;height:16px;line-height:16px;font-weight:bold;"');sb_html.append("></div>");var _divTextArea=jQuery(sb_html.toString())[0];_divContainer.appendChild(_divTextArea)}jQuery(document.getElementById(strWorkflowNodeCode+"__draggable_connect_point_textarea")).text(strConnectPointNo);_divContainer.style.left=(objNodeUIPosition.center_x-12)+"px";_divContainer.style.top=(objNodeUIPosition.center_y-12)+"px";return _divContainer};HXWebWorkflowEditor._DragDropProcess._CreateWorkflowNodeConfigAndRemoveHtmlButton=function(strWorkflowNodeType,strWorkflowNodeCode,objNodeUIPosition){var _imgTemp=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strWorkflowNodeCode+"__img_config_btn","hxworkflownode_config_btn.png",1003,{workflow_node_type:strWorkflowNodeType,workflow_node_code:strWorkflowNodeCode,workflow_html_element_type:"hxworkflow_node_config_btn"});_imgTemp.style.display="";if(strWorkflowNodeType=="WORKFLOW_PARALLEL__END"){_imgTemp.style.left=(objNodeUIPosition.center_x-objNodeUIPosition.width/2)+"px";_imgTemp.style.top=(objNodeUIPosition.center_y+4+3)+"px"}else{if(strWorkflowNodeType=="WORKFLOW_PARALLEL__BEGIN"){_imgTemp.style.left=(objNodeUIPosition.center_x-objNodeUIPosition.width/2)+"px";_imgTemp.style.top=(objNodeUIPosition.center_y-4-18)+"px"}else{if(strWorkflowNodeType=="WORKFLOW_RULE"||strWorkflowNodeType=="WORKFLOW_BRANCH"){_imgTemp.style.left=(objNodeUIPosition.center_x-20-8)+"px";_imgTemp.style.top=(objNodeUIPosition.center_y-17-16)+"px"}else{if(strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"||strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_OUT"){_imgTemp.style.left=(objNodeUIPosition.center_x-12-15)+"px";_imgTemp.style.top=(objNodeUIPosition.center_y-12-16)+"px"}else{if(strWorkflowNodeType=="WORKFLOW_ACTIVITY"){_imgTemp.style.left=(objNodeUIPosition.center_x-objNodeUIPosition.width/2)+"px";_imgTemp.style.top=(objNodeUIPosition.center_y-objNodeUIPosition.height/2-18)+"px"}else{_imgTemp.style.left=(objNodeUIPosition.center_x-objNodeUIPosition.width/2-8)+"px";_imgTemp.style.top=(objNodeUIPosition.center_y-objNodeUIPosition.height/2-16)+"px"}}}}}if(strWorkflowNodeType=="WORKFLOW_ACTIVITY"){_imgTemp=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strWorkflowNodeCode+"__img_resize_btn","hxworkflownode_resize_btn.png",1003,{workflow_node_type:strWorkflowNodeType,workflow_node_code:strWorkflowNodeCode,workflow_html_element_type:"hxworkflow_node_resize_btn"});_imgTemp.style.display="";_imgTemp.style.cursor="pointer";_imgTemp.style.left=(objNodeUIPosition.center_x+objNodeUIPosition.width/2-48)+"px";_imgTemp.style.top=(objNodeUIPosition.center_y-objNodeUIPosition.height/2-18)+"px"}if(strWorkflowNodeType!="WORKFLOW_START"){_imgTemp=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strWorkflowNodeCode+"__img_remove_btn","hxworkflownode_remove_btn.png",1003,{workflow_node_type:strWorkflowNodeType,workflow_node_code:strWorkflowNodeCode,workflow_html_element_type:"hxworkflow_node_remove_btn"});_imgTemp.style.display="";if(strWorkflowNodeType=="WORKFLOW_PARALLEL__END"){_imgTemp.style.left=(objNodeUIPosition.center_x+objNodeUIPosition.width/2-16)+"px";_imgTemp.style.top=(objNodeUIPosition.center_y+4+3)+"px"}else{if(strWorkflowNodeType=="WORKFLOW_PARALLEL__BEGIN"){_imgTemp.style.left=(objNodeUIPosition.center_x+objNodeUIPosition.width/2-16)+"px";_imgTemp.style.top=(objNodeUIPosition.center_y-4-18)+"px"}else{if(strWorkflowNodeType=="WORKFLOW_RULE"||strWorkflowNodeType=="WORKFLOW_BRANCH"){_imgTemp.style.left=(objNodeUIPosition.center_x+20-8)+"px";_imgTemp.style.top=(objNodeUIPosition.center_y-17-16)+"px"}else{if(strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"||strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_OUT"){_imgTemp.style.left=(objNodeUIPosition.center_x+12)+"px";_imgTemp.style.top=(objNodeUIPosition.center_y-12-16)+"px"}else{if(strWorkflowNodeType=="WORKFLOW_ACTIVITY"){_imgTemp.style.left=(objNodeUIPosition.center_x+objNodeUIPosition.width/2-16)+"px";_imgTemp.style.top=(objNodeUIPosition.center_y-objNodeUIPosition.height/2-18)+"px"}else{_imgTemp.style.left=(objNodeUIPosition.center_x+objNodeUIPosition.width/2-7)+"px";_imgTemp.style.top=(objNodeUIPosition.center_y-objNodeUIPosition.height/2-16)+"px"}}}}}}};HXWebWorkflowEditor._DragDropProcess._OnNodeChosenElementDragStopped=function(event,ui){var strWorkflowNodeCode=jQuery(event.target).attr("hx_workflow_node_code");if(strWorkflowNodeCode==null||strWorkflowNodeCode==""){return}var objHXXmlNodeForWorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strWorkflowNodeCode);if(objHXXmlNodeForWorkflowNode==null){return}var strWorkflowNodeType=objHXXmlNodeForWorkflowNode.GetAttributeValue("TYPE");objNodeUIPosition=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetWorkflowNodeUIData(objHXXmlNodeForWorkflowNode);var ptNewCenterPoint;if(strWorkflowNodeType=="WORKFLOW_RULE"||strWorkflowNodeType=="WORKFLOW_BRANCH"){ptNewCenterPoint={x:ui.position.left+20,y:ui.position.top+17}}else{ptNewCenterPoint={x:ui.position.left+objNodeUIPosition.width/2,y:ui.position.top+objNodeUIPosition.height/2}}HXWebWorkflowEditor.WorkflowDefinitionUtility.UpdateWorkflowNodeUIData(strWorkflowNodeCode,ptNewCenterPoint);HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(strWorkflowNodeCode);if(strWorkflowNodeType=="WORKFLOW_PARALLEL__END"){var intRouteCount=parseInt(objHXXmlNodeForWorkflowNode.GetAttributeValue("ROUTE_COUNT"));for(var intRouteIndex=1;intRouteIndex<=intRouteCount;intRouteIndex++){var objHXXmlNodeList=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetWorkflowNodeListWhichPointToSpecifiedNode(strWorkflowNodeCode+","+intRouteIndex.toString());for(var i=0;i<objHXXmlNodeList.length;i++){HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(objHXXmlNodeList[i].GetAttributeValue("CODE"))}}}else{if(strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"){var strConnectPointNo=objHXXmlNodeForWorkflowNode.GetAttributeValue("CONNECT_POINT_NO");var objHXXmlDoc=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow;var objHXXmlNodeList=objHXXmlDoc.SelectNodes("//HXWORKFLOW_NODE[.//UI_DATA/UI_LINE/@LINE_END_TARGET_TYPE='connect_point' and UI_DATA/UI_LINE/@TARGET_CONNECT_POINT_NO="+strConnectPointNo+"]");for(var i=0;i<objHXXmlNodeList.length;i++){HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(objHXXmlNodeList[i].GetAttributeValue("CODE"))}}else{var objHXXmlNodeList=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetWorkflowNodeListWhichPointToSpecifiedNode(strWorkflowNodeCode);for(var i=0;i<objHXXmlNodeList.length;i++){HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(objHXXmlNodeList[i].GetAttributeValue("CODE"))}}}HXWebWorkflowEditor._DragDropProcess.MarkWorkflowNodeAsDraggable(strWorkflowNodeCode,true)};HXWebWorkflowEditor._DragDropProcess._OnToolboxIconDragStopped=function(event,ui){var objEventSrcElement=event.target;var intIconOrgTop=parseInt(jQuery(objEventSrcElement).attr("hx_icon_org_top"));objEventSrcElement.style.left="15px";objEventSrcElement.style.top=intIconOrgTop+"px";if(ui.position.left<90){return}var ptLeftTopCorner={left:ui.position.left-80,top:ui.position.top};var strWorkflowNodeType=jQuery(event.target).attr("hx_workflow_node_type");if(strWorkflowNodeType==null||strWorkflowNodeType==""){return}strWorkflowNodeType=strWorkflowNodeType.toUpperCase();var strActivityType=jQuery(event.target).attr("hx_activity_type");var strNewWorkflowNodeCode="";if(strWorkflowNodeType=="WORKFLOW_RULE"){strNewWorkflowNodeCode=HXWebWorkflowEditor.WorkflowDefinitionUtility.AppendNewWorkflowRuleNode(ptLeftTopCorner)}else{if(strWorkflowNodeType=="WORKFLOW_BRANCH"){strNewWorkflowNodeCode=HXWebWorkflowEditor.WorkflowDefinitionUtility.AppendNewWorkflowBranchNode(ptLeftTopCorner)}else{if(strWorkflowNodeType=="WORKFLOW_END__AGREE"||strWorkflowNodeType=="WORKFLOW_END__REFUSE"){strNewWorkflowNodeCode=HXWebWorkflowEditor.WorkflowDefinitionUtility.AppendNewWorkflowEndNode(ptLeftTopCorner,(strWorkflowNodeType=="WORKFLOW_END__AGREE"))}else{if(strWorkflowNodeType=="WORKFLOW_ACTIVITY"){var strIsAutoTask=jQuery(event.target).attr("hx_is_auto_task");var blnIsAutoTask=(strIsAutoTask!=null&&strIsAutoTask!=""&&strIsAutoTask!="0");strNewWorkflowNodeCode=HXWebWorkflowEditor.WorkflowDefinitionUtility.AppendNewWorkflowActivityNode(ptLeftTopCorner,strActivityType,blnIsAutoTask)}else{if(strWorkflowNodeType=="WORKFLOW_PARALLEL__BEGIN"){strNewWorkflowNodeCode=HXWebWorkflowEditor.WorkflowDefinitionUtility.AppendNewWorkflowParallelBeginNode(ptLeftTopCorner)}else{if(strWorkflowNodeType=="WORKFLOW_PARALLEL__END"){strNewWorkflowNodeCode=HXWebWorkflowEditor.WorkflowDefinitionUtility.AppendNewWorkflowParallelEndNode(ptLeftTopCorner)}else{if(strWorkflowNodeType=="WORKFLOW_CONNECT_POINT"){strTemp=HXWebWorkflowEditor.WorkflowDefinitionUtility.AppendNewWorkflowConnectPoint(ptLeftTopCorner);if(strTemp!=null&&strTemp!=""){var arrTemp=strTemp.split(";");HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(arrTemp[0]);HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(arrTemp[1]);return}}}}}}}}if(strNewWorkflowNodeCode!=null&&strNewWorkflowNodeCode!=""){HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(strNewWorkflowNodeCode)}};HXWebWorkflowEditor._DragDropProcess._OnDropOverCallback=function(event,ui){var strWorkflowNodeCode=jQuery(event.target).attr("hx_workflow_node_code");if(strWorkflowNodeCode==null||strWorkflowNodeCode==""){return}var strWorkflowNodeType=jQuery(event.target).attr("hx_workflow_node_type");if(strWorkflowNodeType==null||strWorkflowNodeType==""){return}strWorkflowNodeType=strWorkflowNodeType.toUpperCase();var strArrowSrcWorkflowNodeCode=jQuery(ui.draggable).attr("hx_workflow_node_code");if(strArrowSrcWorkflowNodeCode==null||strArrowSrcWorkflowNodeCode==""){return}var strArrowSrcWorkflowNodeType=jQuery(ui.draggable).attr("hx_workflow_node_type");if(strArrowSrcWorkflowNodeType==null||strArrowSrcWorkflowNodeType==""){return}strArrowSrcWorkflowNodeType=strArrowSrcWorkflowNodeType.toUpperCase();if(strWorkflowNodeCode.toLowerCase()==strArrowSrcWorkflowNodeCode.toLowerCase()){return}if(strArrowSrcWorkflowNodeType=="WORKFLOW_START"&&strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"){return}if(strArrowSrcWorkflowNodeType=="WORKFLOW_CONNECT_POINT_OUT"&&strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"){return}HXWebWorkflowEditor._DragDropProcess.MarkNodeDroppableAndShowHotPoints(strWorkflowNodeCode,{x:ui.position.left+5,y:ui.position.top+10});HXWebWorkflowEditor._Internal._CurrentDropedOverWorkflowNodeCode=strWorkflowNodeCode};HXWebWorkflowEditor._DragDropProcess._OnDropOutCallback=function(event,ui){var strWorkflowNodeCode=jQuery(event.target).attr("hx_workflow_node_code");if(strWorkflowNodeCode==null||strWorkflowNodeCode==""){return}var strWorkflowNodeType=jQuery(event.target).attr("hx_workflow_node_type");if(strWorkflowNodeType==null||strWorkflowNodeType==""){return}strWorkflowNodeType=strWorkflowNodeType.toUpperCase();var strArrowSrcWorkflowNodeCode=jQuery(ui.draggable).attr("hx_workflow_node_code");if(strArrowSrcWorkflowNodeCode==null||strArrowSrcWorkflowNodeCode==""){return}var strArrowSrcWorkflowNodeType=jQuery(ui.draggable).attr("hx_workflow_node_type");if(strArrowSrcWorkflowNodeType==null||strArrowSrcWorkflowNodeType==""){return}strArrowSrcWorkflowNodeType=strArrowSrcWorkflowNodeType.toUpperCase();if(strWorkflowNodeCode.toLowerCase()==strArrowSrcWorkflowNodeCode.toLowerCase()){return}if(strArrowSrcWorkflowNodeType=="WORKFLOW_START"&&strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"){return}if(strArrowSrcWorkflowNodeType=="WORKFLOW_CONNECT_POINT_OUT"&&strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"){return}HXWebWorkflowEditor._DragDropProcess.RemoveNodeDroppableEffectAndHideHotPoints(strWorkflowNodeCode);HXWebWorkflowEditor._Internal._CurrentDropedOverWorkflowNodeCode=""};HXWebWorkflowEditor._DragDropProcess._OnLineEndArrowDragOver=function(event,ui){var strCurrentDragOverNodeCode=HXWebWorkflowEditor._Internal._CurrentDropedOverWorkflowNodeCode;if(strCurrentDragOverNodeCode==null||strCurrentDragOverNodeCode==""){return}HXWebWorkflowEditor._DragDropProcess.MarkNodeDroppableAndShowHotPoints(strCurrentDragOverNodeCode,{x:ui.position.left+5,y:ui.position.top+10})};HXWebWorkflowEditor._DragDropProcess.MarkNodeDroppableAndShowHotPoints=function(strWorkflowNodeCode,ptArrow){var objHXXmlNode_WorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strWorkflowNodeCode);if(objHXXmlNode_WorkflowNode==null){return}var strWorkflowNodeType=objHXXmlNode_WorkflowNode.GetAttributeValue("TYPE");if(strWorkflowNodeType=="WORKFLOW_START"||strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_OUT"){return}var nodeUIPosition=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetWorkflowNodeUIData(objHXXmlNode_WorkflowNode);HXWebWorkflowEditor._DragDropProcess._ShowWorkflowNodeDroppableBlueBorder(strWorkflowNodeType,strWorkflowNodeCode,objHXXmlNode_WorkflowNode,nodeUIPosition);if(strWorkflowNodeType=="WORKFLOW_PARALLEL__END"){HXWebWorkflowEditor._DragDropProcess._ShowParallelEndNodeHotPoints(strWorkflowNodeCode,objHXXmlNode_WorkflowNode,nodeUIPosition,ptArrow);return}var ptHotPointTop,ptHotPointLeft,ptHotPointRight;if(strWorkflowNodeType=="WORKFLOW_RULE"||strWorkflowNodeType=="WORKFLOW_BRANCH"){ptHotPointTop={x:nodeUIPosition.center_x,y:nodeUIPosition.center_y-17};ptHotPointLeft={x:nodeUIPosition.center_x-20,y:nodeUIPosition.center_y};ptHotPointRight={x:nodeUIPosition.center_x+ +20,y:nodeUIPosition.center_y}}else{ptHotPointTop={x:nodeUIPosition.center_x,y:nodeUIPosition.center_y-nodeUIPosition.height/2};ptHotPointLeft={x:nodeUIPosition.center_x-nodeUIPosition.width/2,y:nodeUIPosition.center_y};ptHotPointRight={x:nodeUIPosition.center_x+nodeUIPosition.width/2,y:nodeUIPosition.center_y}}if(strWorkflowNodeType=="WORKFLOW_PARALLEL__BEGIN"||strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"){var strTempHtmlId=strWorkflowNodeCode+"__img_hotpoint_top";var strTempImgFileName="hxworkflownode_hotpoint_fit.png";_imgTemp=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strTempHtmlId,strTempImgFileName,1003);_imgTemp.style.display="";_imgTemp.style.left=(ptHotPointTop.x-4)+"px";_imgTemp.style.top=(ptHotPointTop.y-4)+"px";return}var intDistance_ToTop=Math.pow(ptArrow.x-ptHotPointTop.x,2)+Math.pow(ptArrow.y-ptHotPointTop.y,2);var intDistance_ToLeft=Math.pow(ptArrow.x-ptHotPointLeft.x,2)+Math.pow(ptArrow.y-ptHotPointLeft.y,2);var intDistance_ToRight=Math.pow(ptArrow.x-ptHotPointRight.x,2)+Math.pow(ptArrow.y-ptHotPointRight.y,2);var blnIsHotPointTopFit=(intDistance_ToTop<=intDistance_ToLeft&&intDistance_ToTop<=intDistance_ToRight);var blnIsHotPointLeftFit=(!blnIsHotPointTopFit&&intDistance_ToLeft<=intDistance_ToRight);var blnIsHotPointRightFit=(!blnIsHotPointTopFit&&!blnIsHotPointLeftFit);var strTempHtmlId=strWorkflowNodeCode+"__img_hotpoint_top";var strTempImgFileName="hxworkflownode_hotpoint"+(blnIsHotPointTopFit?"_fit":"")+".png";_imgTemp=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strTempHtmlId,strTempImgFileName,1003);_imgTemp.src="../hximages_v6/hxworkflow/"+strTempImgFileName;_imgTemp.style.display="";_imgTemp.style.left=(ptHotPointTop.x-4)+"px";_imgTemp.style.top=(ptHotPointTop.y-4)+"px";strTempHtmlId=strWorkflowNodeCode+"__img_hotpoint_left";strTempImgFileName="hxworkflownode_hotpoint"+(blnIsHotPointLeftFit?"_fit":"")+".png";_imgTemp=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strTempHtmlId,strTempImgFileName,1003);_imgTemp.src="../hximages_v6/hxworkflow/"+strTempImgFileName;_imgTemp.style.display="";_imgTemp.style.left=(ptHotPointLeft.x-4)+"px";_imgTemp.style.top=(ptHotPointLeft.y-4)+"px";strTempHtmlId=strWorkflowNodeCode+"__img_hotpoint_right";strTempImgFileName="hxworkflownode_hotpoint"+(blnIsHotPointRightFit?"_fit":"")+".png";_imgTemp=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strTempHtmlId,strTempImgFileName,1003);_imgTemp.src="../hximages_v6/hxworkflow/"+strTempImgFileName;_imgTemp.style.display="";_imgTemp.style.left=(ptHotPointRight.x-4)+"px";_imgTemp.style.top=(ptHotPointRight.y-4)+"px"};HXWebWorkflowEditor._DragDropProcess._ShowWorkflowNodeDroppableBlueBorder=function(strWorkflowNodeType,strWorkflowNodeCode,objHXXmlNode_WorkflowNode,nodeUIPosition){var strTempHtmlId,strTempImgFileName;var _imgTemp;if(strWorkflowNodeType=="WORKFLOW_RULE"||strWorkflowNodeType=="BRANCH"){strTempHtmlId=strWorkflowNodeCode+"__pointed_to_frame_img";strTempImgFileName="hxworkflowbranch_pointedto_frame.png";_imgTemp=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strTempHtmlId,strTempImgFileName,1003);_imgTemp.style.display="";_imgTemp.style.left=(nodeUIPosition.center_x-20)+"px";_imgTemp.style.top=(nodeUIPosition.center_y-17)+"px";return}if(strWorkflowNodeType=="WORKFLOW_END__AGREE"||strWorkflowNodeType=="WORKFLOW_END__REFUSE"){strTempHtmlId=strWorkflowNodeCode+"__pointed_to_frame_img";strTempImgFileName="hxworkflowend_pointedto_frame.png";_imgTemp=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strTempHtmlId,strTempImgFileName,1003);_imgTemp.style.display="";_imgTemp.style.left=(nodeUIPosition.center_x-15)+"px";_imgTemp.style.top=(nodeUIPosition.center_y-15)+"px";return}if(strWorkflowNodeType=="WORKFLOW_PARALLEL__BEGIN"||strWorkflowNodeType=="WORKFLOW_PARALLEL__END"){strTempHtmlId=strWorkflowNodeCode+"__pointed_to_frame_img";strTempImgFileName="hxworkflowparallel_"+(strWorkflowNodeType=="WORKFLOW_PARALLEL__BEGIN"?"begin":"end")+"_pointedto_frame.png";_imgTemp=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strTempHtmlId,strTempImgFileName,1003);_imgTemp.style.display="";_imgTemp.style.left=(nodeUIPosition.center_x-nodeUIPosition.width/2)+"px";_imgTemp.style.top=(nodeUIPosition.center_y-4)+"px";_imgTemp.style.width=nodeUIPosition.width+"px";_imgTemp.style.height="8px";return}if(strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"){strTempHtmlId=strWorkflowNodeCode+"__pointed_to_frame_img";strTempImgFileName="hxworkflowconnectpoint_pointedto_frame.png";_imgTemp=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strTempHtmlId,strTempImgFileName,1003);_imgTemp.style.display="";_imgTemp.style.left=(nodeUIPosition.center_x-12)+"px";_imgTemp.style.top=(nodeUIPosition.center_y-12)+"px";return}if(strWorkflowNodeType=="WORKFLOW_ACTIVITY"){var _divContainer=document.getElementById(strWorkflowNodeCode+"__activity_div_area");if(_divContainer==null){return}_divContainer.style.borderColor="blue"}};HXWebWorkflowEditor._DragDropProcess._ShowParallelEndNodeHotPoints=function(strWorkflowNodeCode,objHXXmlNode_WorkflowNode,nodeUIPosition,ptArrow){var intTemp,_imgTemp;var intRouteCount=parseInt(objHXXmlNode_WorkflowNode.GetAttributeValue("ROUTE_COUNT"));var ptHotPoint={x:0,y:0};ptHotPoint.y=nodeUIPosition.center_y-nodeUIPosition.height/2;var intMinDistinceToFit=100000000;var intRouteNoToFit=-1;for(var intRouteIndex=1;intRouteIndex<=intRouteCount;intRouteIndex++){if(intRouteIndex==1){ptHotPoint.x=nodeUIPosition.center_x-nodeUIPosition.width/2+8}else{if(intRouteIndex>=intRouteCount){ptHotPoint.x=nodeUIPosition.center_x+nodeUIPosition.width/2-8}else{ptHotPoint.x=nodeUIPosition.center_x-nodeUIPosition.width/2+nodeUIPosition.width*(intRouteIndex-1)/(intRouteCount-1)}}intTemp=Math.pow(ptArrow.x-ptHotPoint.x,2)+Math.pow(ptArrow.y-ptHotPoint.y,2);if(intTemp<intMinDistinceToFit){intMinDistinceToFit=intTemp;intRouteNoToFit=intRouteIndex}var strTempHtmlId=strWorkflowNodeCode+"__img_hotpoint_route_"+intRouteIndex;var strTempImgFileName="hxworkflownode_hotpoint.png";_imgTemp=HXWebWorkflowEditor._Internal._CreateNewImgHtmlElement(strTempHtmlId,strTempImgFileName,1003);_imgTemp.src="../hximages_v6/hxworkflow/"+strTempImgFileName;_imgTemp.style.display="";_imgTemp.style.left=(ptHotPoint.x-4)+"px";_imgTemp.style.top=(ptHotPoint.y-4)+"px"}if(intRouteNoToFit>0){_imgTemp=document.getElementById(strWorkflowNodeCode+"__img_hotpoint_route_"+intRouteNoToFit);if(_imgTemp!=null){_imgTemp.src="../hximages_v6/hxworkflow/hxworkflownode_hotpoint_fit.png"}}};HXWebWorkflowEditor._DragDropProcess.RemoveNodeDroppableEffectAndHideHotPoints=function(strWorkflowNodeCode){if(strWorkflowNodeCode==null||strWorkflowNodeCode==""){strWorkflowNodeCode=HXWebWorkflowEditor._Internal._CurrentDropedOverWorkflowNodeCode;HXWebWorkflowEditor._Internal._CurrentDropedOverWorkflowNodeCode="";if(strWorkflowNodeCode==null||strWorkflowNodeCode==""){return}}var _imgTemp=document.getElementById(strWorkflowNodeCode+"__img_hotpoint_top");if(_imgTemp!=null){_imgTemp.style.display="none"}_imgTemp=document.getElementById(strWorkflowNodeCode+"__img_hotpoint_left");if(_imgTemp!=null){_imgTemp.style.display="none"}_imgTemp=document.getElementById(strWorkflowNodeCode+"__img_hotpoint_right");if(_imgTemp!=null){_imgTemp.style.display="none"}var objHXXmlNode_WorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strWorkflowNodeCode);if(objHXXmlNode_WorkflowNode==null){return}var strWorkflowNodeType=objHXXmlNode_WorkflowNode.GetAttributeValue("TYPE");if(strWorkflowNodeType=="WORKFLOW_PARALLEL__END"){var intRountCount=parseInt(objHXXmlNode_WorkflowNode.GetAttributeValue("ROUTE_COUNT"));for(var i=1;i<=intRountCount;i++){_imgTemp=document.getElementById(strWorkflowNodeCode+"__img_hotpoint_route_"+i);if(_imgTemp!=null){_imgTemp.style.display="none"}}}_imgTemp=document.getElementById(strWorkflowNodeCode+"__pointed_to_frame_img");if(_imgTemp!=null){_imgTemp.style.display="none";return}var _divContainer=document.getElementById(strWorkflowNodeCode+"__activity_div_area");if(_divContainer!=null){_divContainer.style.borderColor="#808080";return}};HXWebWorkflowEditor._DragDropProcess._OnDropEndCallback=function(event,ui){var strTargetWorkflowNodeCode=jQuery(event.target).attr("hx_workflow_node_code");if(strTargetWorkflowNodeCode==null||strTargetWorkflowNodeCode==""){return}var strTargetWorkflowNodeType=jQuery(event.target).attr("hx_workflow_node_type");if(strTargetWorkflowNodeType==null||strTargetWorkflowNodeType==""){return}strTargetWorkflowNodeType=strTargetWorkflowNodeType.toUpperCase();var strArrowSrcWorkflowNodeCode=jQuery(ui.draggable).attr("hx_workflow_node_code");if(strArrowSrcWorkflowNodeCode==null||strArrowSrcWorkflowNodeCode==""){return}var strArrowSrcWorkflowNodeType=jQuery(ui.draggable).attr("hx_workflow_node_type");if(strArrowSrcWorkflowNodeType==null||strArrowSrcWorkflowNodeType==""){return}strArrowSrcWorkflowNodeType=strArrowSrcWorkflowNodeType.toUpperCase();var strArrowSrcLineType=jQuery(ui.draggable).attr("hx_workflow_line_type");if(strTargetWorkflowNodeCode.toLowerCase()==strArrowSrcWorkflowNodeCode.toLowerCase()){return}if(strArrowSrcWorkflowNodeType=="WORKFLOW_START"&&strTargetWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"){return}if(strArrowSrcWorkflowNodeType=="WORKFLOW_CONNECT_POINT_OUT"&&strTargetWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"){return}HXWebWorkflowEditor._DragDropProcess.RemoveNodeDroppableEffectAndHideHotPoints(strTargetWorkflowNodeCode);HXWebWorkflowEditor._DragDropProcess._ChangeWorkflowNodeLineTargetInfo(strArrowSrcWorkflowNodeType,strArrowSrcWorkflowNodeCode,strArrowSrcLineType,strTargetWorkflowNodeType,strTargetWorkflowNodeCode,{x:ui.position.left+5,y:ui.position.top+10})};HXWebWorkflowEditor._DragDropProcess._OnLineEndArrowDragStopped=function(event,ui){var strWorkflowNodeType=jQuery(ui.helper).attr("hx_workflow_node_type");var strWorkflowNodeCode=jQuery(ui.helper).attr("hx_workflow_node_code");var strWorkflowLineCode=jQuery(ui.helper).attr("hx_workflow_line_code");var objHXXmlNodeForWorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strWorkflowNodeCode);var objTempHXXmlNodeForUILine;if(strWorkflowNodeType.toUpperCase()=="WORKFLOW_START"){objTempHXXmlNodeForUILine=objHXXmlNodeForWorkflowNode.SelectSingleNode(".//UI_DATA/UI_LINE")}else{objTempHXXmlNodeForUILine=objHXXmlNodeForWorkflowNode.SelectSingleNode(".//UI_DATA/UI_LINE[@CODE='"+strWorkflowLineCode+"']")}var strTemp=objTempHXXmlNodeForUILine.GetAttributeValue("LINE_END_TARGET_TYPE");if(strTemp==null||strTemp==""){var strLineType=objTempHXXmlNodeForUILine.GetAttributeValue("LINE_TYPE");var ptLineEndPosition={x:ui.position.left+5,y:ui.position.top+10};HXWebWorkflowEditor.WorkflowDefinitionUtility.UpdateWorkflowNodeUILineSetting(strWorkflowNodeType,objHXXmlNodeForWorkflowNode,strLineType,ptLineEndPosition)}HXWebWorkflowEditor._DragDropProcess.RemoveNodeDroppableEffectAndHideHotPoints();HXWebWorkflowEditor.CommonElement.DrawWorkflowNodeWithLine(strWorkflowNodeCode);HXWebWorkflowEditor._DragDropProcess.MarkWorkflowNodeAsDraggable(strWorkflowNodeCode,true)};HXWebWorkflowEditor._DragDropProcess._ChangeWorkflowNodeLineTargetInfo=function(strArrowSrcWorkflowNodeType,strArrowSrcWorkflowNodeCode,strArrowSrcLineType,strTargetWorkflowNodeType,strTargetWorkflowNodeCode,ptArrowPosition){var objHXXmlNodeForSrcWorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strArrowSrcWorkflowNodeCode);var strLineEndArrowDirection,strLineEndTargetType;var strTargetConnectPointNo;var ptLineEndPosition=HXWebWorkflowEditor._DragDropProcess._GetElementMatchedHotPointInfo(strTargetWorkflowNodeCode,ptArrowPosition);if(strTargetWorkflowNodeType=="WORKFLOW_PARALLEL__END"){strLineEndArrowDirection="to_bottom";strLineEndTargetType="node";var intTargetRouteNo=ptLineEndPosition.route_no;strTargetWorkflowNodeCode=strTargetWorkflowNodeCode+","+intTargetRouteNo}else{if(strTargetWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"){strLineEndTargetType="connect_point";strLineEndArrowDirection=ptLineEndPosition.line_end_arrow_direction;var objHXXmlNodeForTargetWorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strTargetWorkflowNodeCode);strTargetConnectPointNo=objHXXmlNodeForTargetWorkflowNode.GetAttributeValue("CONNECT_POINT_NO");var objTempHXXmlNode=HXWebWorkflowEditor._Internal._HXXmlDocForWorkflow.SelectSingleNode("//HXWORKFLOW_NODE[@TYPE='WORKFLOW_CONNECT_POINT_OUT' and @CONNECT_POINT_NO='"+strTargetConnectPointNo+"']");strTargetWorkflowNodeCode=objTempHXXmlNode.GetAttributeValue("TARGET_NODE_CODE")}else{strLineEndTargetType="node";strLineEndArrowDirection=ptLineEndPosition.line_end_arrow_direction}}HXWebWorkflowEditor.WorkflowDefinitionUtility.UpdateWorkflowNodeUILineSetting(strArrowSrcWorkflowNodeType,objHXXmlNodeForSrcWorkflowNode,strArrowSrcLineType,ptLineEndPosition,strLineEndArrowDirection,strLineEndTargetType,strTargetConnectPointNo);HXWebWorkflowEditor.WorkflowDefinitionUtility._UpdateTargetNodeCodeViaLineType(strArrowSrcWorkflowNodeType,objHXXmlNodeForSrcWorkflowNode,strArrowSrcLineType,strTargetWorkflowNodeCode)};HXWebWorkflowEditor._DragDropProcess._GetElementMatchedHotPointInfo=function(strWorkflowNodeCode,ptArrow){var objHXXmlNode_WorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strWorkflowNodeCode);if(objHXXmlNode_WorkflowNode==null){return null}var strWorkflowNodeType=objHXXmlNode_WorkflowNode.GetAttributeValue("TYPE");if(strWorkflowNodeType=="WORKFLOW_START"||strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_OUT"){return null}var nodeUIPosition=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetWorkflowNodeUIData(objHXXmlNode_WorkflowNode);if(strWorkflowNodeType=="WORKFLOW_PARALLEL__END"){return HXWebWorkflowEditor._DragDropProcess._GetParallelEndNodeMatchedHotPointInfo(strWorkflowNodeCode,ptArrow)}var ptHotPointTop,ptHotPointLeft,ptHotPointRight;if(strWorkflowNodeType=="WORKFLOW_RULE"||strWorkflowNodeType=="WORKFLOW_BRANCH"){ptHotPointTop={x:nodeUIPosition.center_x,y:nodeUIPosition.center_y-17};ptHotPointLeft={x:nodeUIPosition.center_x-20,y:nodeUIPosition.center_y};ptHotPointRight={x:nodeUIPosition.center_x+ +20,y:nodeUIPosition.center_y}}else{ptHotPointTop={x:nodeUIPosition.center_x,y:nodeUIPosition.center_y-nodeUIPosition.height/2};ptHotPointLeft={x:nodeUIPosition.center_x-nodeUIPosition.width/2,y:nodeUIPosition.center_y};ptHotPointRight={x:nodeUIPosition.center_x+nodeUIPosition.width/2,y:nodeUIPosition.center_y}}if(strWorkflowNodeType=="WORKFLOW_PARALLEL__BEGIN"||strWorkflowNodeType=="WORKFLOW_CONNECT_POINT_IN"){return{x:ptHotPointTop.x,y:ptHotPointTop.y,line_end_arrow_direction:"to_bottom"}}var intDistance_ToTop=Math.pow(ptArrow.x-ptHotPointTop.x,2)+Math.pow(ptArrow.y-ptHotPointTop.y,2);var intDistance_ToLeft=Math.pow(ptArrow.x-ptHotPointLeft.x,2)+Math.pow(ptArrow.y-ptHotPointLeft.y,2);var intDistance_ToRight=Math.pow(ptArrow.x-ptHotPointRight.x,2)+Math.pow(ptArrow.y-ptHotPointRight.y,2);var blnIsHotPointTopFit=(intDistance_ToTop<=intDistance_ToLeft&&intDistance_ToTop<=intDistance_ToRight);var blnIsHotPointLeftFit=(!blnIsHotPointTopFit&&intDistance_ToLeft<=intDistance_ToRight);var blnIsHotPointRightFit=(!blnIsHotPointTopFit&&!blnIsHotPointLeftFit);if(blnIsHotPointTopFit){return{x:ptHotPointTop.x,y:ptHotPointTop.y,line_end_arrow_direction:"to_bottom"}}else{if(blnIsHotPointLeftFit){return{x:ptHotPointLeft.x,y:ptHotPointLeft.y,line_end_arrow_direction:"to_right"}}}return{x:ptHotPointRight.x,y:ptHotPointRight.y,line_end_arrow_direction:"to_left"}};HXWebWorkflowEditor._DragDropProcess._GetParallelEndNodeMatchedHotPointInfo=function(strParallelEndWorkflowNodeCode,ptArrow){var objHXXmlNode_WorkflowNode=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetXmlDefinitionOfWorkflowNode(strParallelEndWorkflowNodeCode);var nodeUIPosition=HXWebWorkflowEditor.WorkflowDefinitionUtility.GetWorkflowNodeUIData(objHXXmlNode_WorkflowNode);var intRouteCount=parseInt(objHXXmlNode_WorkflowNode.GetAttributeValue("ROUTE_COUNT"));var ptHotPoint={x:0,y:0};ptHotPoint.y=nodeUIPosition.center_y-4;var intMinDistinceToFit=100000000;var intRouteNoToFit=-1;for(var intRouteIndex=1;intRouteIndex<=intRouteCount;intRouteIndex++){if(intRouteIndex==1){ptHotPoint.x=nodeUIPosition.center_x-nodeUIPosition.width/2+8}else{if(intRouteIndex>=intRouteCount){ptHotPoint.x=nodeUIPosition.center_x+nodeUIPosition.width/2-8}else{ptHotPoint.x=nodeUIPosition.center_x-nodeUIPosition.width/2+nodeUIPosition.width*(intRouteIndex-1)/(intRouteCount-1)}}intTemp=Math.pow(ptArrow.x-ptHotPoint.x,2)+Math.pow(ptArrow.y-ptHotPoint.y,2);if(intTemp<intMinDistinceToFit){intMinDistinceToFit=intTemp;intRouteNoToFit=intRouteIndex}}ptHotPoint.route_no=intRouteNoToFit;return ptHotPoint};